# DIS:Legacy v1.162BETA3
# Update: "EQUITES PORRO" - Proto
内部的なシステムが大幅に組み替えられたためバグりがちです。何か見つけたら報告お願いします。  
絶賛リリース期日延期中！  

#### **v1.162BETAFinalロードマップ：**
- 研究と建物の一部のjsによる管理対応
- **ステージ追加(ほんとに)**  
  
~~９月中ごろから後半~~１０月~~中旬~~下旬の正式リリースが目標。ステージ追加以外は大して変わりません。
  

#### **v1.7BETAロードマップ：**
- ユニット最大数を990まで拡張
- キーコンフィグ追加
- 弾システムのリファクタリング
- UIの完全リファクタリング(jsによる制御)
- 遠投投石機の追加
- 新ファクション追加
- 投擲武器のリロードとAIによる自動持ち替え制御  
- 砲撃兵器に砲撃地点指定操作を追加  
- 馬とアクセサリの分離?  
- カスタムユニットシステム実装？（Elonaのあれみたいな）  
- テクノロジー・建物・勢力のjs制御完全化？（気合い入れて解読すれば勢力等々を追加できる感じで）  
- ユニットセリフシステム実装？（ヴァーレンのあれみたいな）  
- マップエディタ追加  
- ステージ製作リファレンス等の用意  
  
#### DIS:Reverberation(仮)  
- コンテンツ追加
- Choomaque氏によるUIリデザイン
- 同氏による音楽トラックの追加
- キャンペーンの追加
  
## 翻訳関係
- ストーリー周り以外を大体GPT4で仮訳。システム文章は仮訳のままいくかもしれません。  
- 地形データ・ステータス画面・ピック可能勢力の解説文・Perk説明文が多言語システムに対応していなかったのを組換え。
- 地形名を英語対応。
- Perkに日本語名を設定。次以降の拡張では日本語名で記述します。
- ユニット説明文周りが残っています。まってね
  
## 追加
  
### 総論
/*
・エンデュランス新ステージ追加
  - 「大八洲」
  …まつろわぬ民が住まう複雑な地形の島々を平定し，外敵の侵入に備えましょう。
  敵はヴァイキングではありません。
  
・戦術マップの追加
  - 「トレーニング（ポテチ）１」
  約一年ほど遅い戦術チュートリアルマップです。  
  ポテチの雑兵と帝国の雑兵の小競り合いです。  
  歩兵隊の組み合わせや配置についての基礎的なことが学べます。ポーズを使わなければおそらく１分で終わります。  

  - 「トレーニング（帝国）」
  「天帝南征」よりも前に起きていた竜族と帝国の小競り合いのうちの一つです。  
  辺境防衛隊の弱いユニットを使ってドラさんたちを撃退しましょう。  
  視界取りと攻城兵器の大切さを学ぶシナリオ……  
  と見せかけて、ユニットパワーの関係で一筋縄ではいかない難度かもしれません。  
*/
  
- Moduleシステムの準備開始
  - 一言で言えば洋ゲーのコンバージョンmodみたいなものを作れるようにようにするシステムです。  
    まだまだ準備中ですが、少しずつゲームディレクトリをさっぱりさせていこうと思っています。  
  
- 操作の追加/削除  
  - Ctrlキーを押しながら右クリックでミニマップ指定以外でも経路探索付きの移動指示をできるように。    
  - Ctrlキーを押しながらの暇な労働者ユニットを呼び出すことで、一括選択ができるように。    
  - 暇な軍事ユニットの一括選択ができるように（予定）    
  - 右クリックドラッグによる単体操作を削除。  
    ミスクリックを誘発しがちだったのと、経路探索の仕様変更への対応のため。  
  
- アドバンスドタイルシステム（仮）  
  - 前々から用意していた高度情報等を動的に変更して描画に反映したりマップタイルを細かく書き換えたりできるシステムの試験を開始。  
    すこし重くなるかもしれませんが，BETA版の軽量化度合いがまず凄まじいのでわからないでしょう。  
  
- Java Script制御のUIシステムを試作。  
  速度的な問題及びセーブロード時の諸々を考慮して、RTS中のUIをjsで管理することはできません。  
  が、それ以外の諸々は、すべて新規UIシステムによって制御されるようになる...予定です。  
  
- らくだ騎兵の追加  
  やしおじ様のご厚意によりらくだのスプライトを頂き、駱駝騎兵が実現。  
  馬よりもさらにパワフルで、砂の上での機動力が高いかわり、当たり判定が縦に長めなため新システムの弓には弱いです。    
  馬に対する通常攻撃特効効果を持っています(BETA3(9.22版)では表示は出ません)    
  
- 新勢力をテスト実装。  
  装備の見た目だけ試験的に試せるようになっています。  
  基本的にモックアップで、試しに遊ぶことができるような完成度ではありません。    
  ユニット性能も仮置き。  
  デベロッパー向け。ベータ版以外ではデベロッパーモード（テスト起動）時のみ選択可能になります。  
  
- 新勢力用装備の一部を先行実装。
  弱めのものを帝国の一部のユニットが装備する程度です。
  
### 各論  
- 帝国  
  - 帝国の厩舎のR枠に「帝国支援ドロメダリィ」を追加。  
    今のところは単なるらくだ騎兵の先行実装枠です。  
  
## 変更  
  

### システム総論  
  - Maniacs Patchバージョン更新
    - なんとJava Scriptによる処理を挟むことができるようになりました。  
      これに対応してマップスクリプトはJava Scriptに完全に依拠したものへと抜本的に変更。  
      プレイヤーにはあまり関係ありませんが。  
  
  - bootconfigをjs制御に変更。
    ついでにディレクトリ整理のためUserディレクトリに移動。  
    これからはUserディレクトリを移せば設定等も引継ぎできるようにする予定です。
    bootconfigを変えていた人はUserディレクトリに移してください。    
    - ついでにゴア表現の有効無効（首が飛ぶのとか）をbootconfigから変更できる機能もようやく実装。
  
### ゲーム総論
  
  - 世界に存在可能な最大ユニット数を845->880に拡張。
    - 最大999まで対応する予定です。メモリ割当の関係上細かな工事が必要なので、完了次第逐次拡張していく形に……
  
  - 描画システム再構築  
    - 今まで一ユニットには6枚のスプライトしか使えませんでした。  
    が，これから理論上9枚まで割り当てられるようになります。  
    とはいえそんなに重ねて表現したいものがいまのところ髪の毛くらいしかないため，とりあえず8枚設定で負荷チェックのテスト。
  
  - ユニット超過密状態を避けるためのシステム変更
    - 前線であまりにもユニットが渋滞している場合は動きが少し遅くなるように変更。
    - 渋滞している場所にユニットが向かう時は少しもたつくように変更。
    - 超過密状態での衝突処理はよりユニットをばらけさせることを意識した計算を行うように変更。
    - 各ユニットのあたり判定を5%だけ大きく変更。  
      結果として、槍兵が斧兵や剣兵に対するリーチ差を活かせる場面が増えています。  
      ポテチのパイク兵やステップランサー系列は相対的に強化されたと言っていいかもしれません。  
      
  
  - 経路探索処理の改善  
    壁周りのおろかな挙動が多少ましになるように変更。  
    - 近接攻撃ユニットは敵を視認してターゲットした際、直で接近可能か否か（間に障害物が挟まるか）を判断してから移動経路を考えるように変更。  
      - ユニットへの移動指示/攻撃指示を出した際も、近接攻撃ユニットは直で攻撃可能か否かを判断するように変更。  
    - 壁を挟んだ相手を目指して移動する場合の挙動を改善。  
    - ユニットが味方の建物に引っかかると、経路探索を行ってうまくすり抜けようとするように変更。  
    - 到達不能な場所が移動地点として指定された場合は、指定された位置までの直進を試み、敵の壁があれば破壊を試みるように変更。  
      今まではずっと近づこうとひたすら頑張って変な場所に行ったりしていました。  
    - そもそも移動不能判定の場所が指定された場合は、近くの移動可能な場所を検索してそちらへの移動を試みるように変更。
  
  - 弓矢と投射武器のシステム変更  
    - 弓矢とクロスボウ  
      - 全ての弓系武器の射程を2pixel分伸長。  
      - 全てのクロスボウ系武器の射程を3pixel分伸長。  
      - 矢の弾道計算を通常の放物投射運動へと変更。  
        勿論全てのユニットは投射角度を計算した上で射撃を行います。  
        たぶん前より引き撃ち操作等が気持ちいいです。  
      - 地面に落下したフレームだけでなく，一定の高さを下回った時点で命中チェックが行われるように変更。  
        騎兵や攻城兵器のような大きいユニットや，飛行ユニット（こちらは本来当てづらい方がリアルかもしれませんがバランス上）に対しては高さの閾値が高くなり、より当たりやすくなります。  
        パラメータを参照する回避判定の合計回数は従来と同じ一回だけですが，  
        これまで弾道がズレてそもそも命中判定が行われないことが多かったHITが低めのユニットでも矢を当てやすくなり，  
        また高HITユニットであれば命中判定が行われないことはまずなくなります。  
      - その代わり低HITのユニットはほんの少しだけ狙いが散らばりやすくなるように変更。
      - 遠隔攻撃の命中判定においてこれまで足されていた基本命中係数を38->22へ低下。  
        加えて弓矢の場合は距離に対応して命中係数が上下するように変更。  
        命中係数の高さは射程範囲の半分程度>最大射程距離>近距離>超近距離という順序で変化するため、ある程度の距離を保てないと困ったことに。  
        近くまで来ている敵に対してはかなり外しやすくなります。  
        相当熟練した弓兵でない限り，盾を持っている相手に対しては厳しい戦いを強いられることになるでしょう。  
      - 命中係数変更については投擲系の武器も影響を受けるため，投槍系武器は補填としてHITボーナスを一律+5，着弾時の当たり判定を1pixel拡大。  
        投げ斧は斧が元々強いのを踏まえて変更なし。むしろ盾に当たりやすくなって好都合かもしれません。  
  
   - 戦闘計算式の変更
    - **装甲値によるHPダメージの吸収率を70%から62.5%へ下方修正**。
       DISは基本的に装甲ゲーであり、お散歩ドラゴンのような例外を除けば基本的に装甲値が高い方が殴り合いに勝つゲームでした。  
      まあリアルといえばリアルかもしれないんですが、現状では武器の装甲貫通率が完全に死にパラメータと化しているのが否めません。  
       加えて良質な鎧に守られた兵士は、戦闘後鎧が完全に破壊されていても、本体は無傷というようなこともままあるように思われます。
      こちらについては、敵味方が血みどろで戦うこのゲームの雰囲気を多少なりとも阻害しているように感じていました。  
       また、押出計算式が変わったことで前線で殴り合いに参加できるユニットの数が減った結果、  
      従来verよりも戦闘時間が少しだけ長引いており、これに対する調整の必要もあります。  
       ...ということで、少しだけARによるHP保護効果を弱くしてみました。  
      帝国とそれ以外の人間ファクションの兵士の質の差が相対的に縮まるかもしれません。  
      竜族とノルド人は変わらないでしょうが。  
    - 盾の回避ボーナス値を近接と遠隔で分離。  
    - **遠隔回避率への盾の数値加算を[盾ボーナス200%]から[盾遠隔回避ボーナス100%]へ変更**。  
      矢の仕様変更の結果、遠隔ユニットが盾兵に対してあまりにも不利になっていたため、是正を期した変更です。  
      弱めの盾兵相手であれば無理やり射抜けるけれど、強い盾兵に対しては今までとそこまで変わらない、というくらいの数値設定にしています。  
      また今後、遠隔防御力を持たないパリィ用の左手武器や、反対に遠隔防御力だけ高いような盾を追加するための準備でもあります。  
      
  
  - 高度システムの変更  
    - より高い位置へ移動する際はSPを消費するように変更。  
      大して変わりませんが，戦闘中しながら高台へ移動しようとするとSPが削れて苦労するかもしれません。  
      特に騎兵はSP消費が激しくなります。起伏のある場所では思わぬ苦戦をするかもしれません。  
      当然ですが飛行ユニットには影響がありません。  
  
  - シールドウォールの変更  
    - 性能変更  
      - シールドウォール中のユニットは、正面から飛んでくる矢弾の回避率が極めて高くなるように変更(計算に使われる**盾の遠隔回避ボーナスが1.5倍**に)。  
       シールドウォールを組んだ戦列がジリジリと接近してくるようなシチュエーションにおいては、弓騎兵で後ろに回り込むか前衛の兵士を用意する必要があるでしょう。  
      - 代わりに、防御系ステータスの上昇率を一律-10%。  
        後述のオーラ効果との関係で、集団でシールドウォールをすると以前と同じ効果が得られます。  
    - オーラ効果の追加  
      - シールドウォール中のユニットに隣接しているユニットは、矢弾の回避率にボーナスを受けるように変更。  
        集団でシールドウォールを組むとより強固な防御効果を得られるようになりました。  
        また、両手持ちユニットも微弱ながらシールドウォール効果の恩恵を得ることができるようになっています。  
        オーラ効果の発動如何については別個表示を追加します(予定)。  
  - 内政バランス調整
  
  - 戦闘バランス調整  
    - 帝国以外の人間ファクションの一般戦闘ユニットの生産速度を一律で少し上昇。  
      これでもう少し数を揃えやすくなるはずです。  
  
    - 騎兵の変更  
      - 「ゴブリンウルフ」以外のすべての馬の移動速度を+2。
      - スピードボーナスを現在移動速度の8%から10%に変更。段々とある意味極端な存在へ変わってきました。  
        騎兵とは衝撃力の具現化なのです。  
        問題は現行のステージにおいてプレイヤーが衝撃力を必要とすることがあまりないことなんですが。  
      - 騎兵が今まで受けていたMelee射程ペナルティを、-4pixelから-2pixelに変更。  
        つまり、もう少しだけ殴り合いに強くなり、また殴り合いに参加できる機会も増えます。  
      - スキル「ランスチャージ」の発生判定計算式を上記変更に合わせて調整。判定は以前とほぼ変わりません。
      - 騎兵は、パイクウォール中の敵ユニットの近くにいるだけで白兵戦ペナルティを受けるように変更。  
    
    - 攻城兵器の変更  
      - 「カタパルト」の最低射程を「帝国破城投石機」と同じ数値に変更。  
        通常のカタパルトの方は帝国のものよりも最低射程が短くセットされていたのですが，意図したものではなかったため延長する形で変更。  
      - 「カタパルト」系ユニットの必要最低射程を少し増加。騎兵で処理しやすいように。  
      - 「破城槌」シリーズのリメイク  
        - やしおじ様からの御厚意を受け、画像を完全に刷新。単体がより大きく、強力になります。  
        - さらに移動アニメーションも追加。
          - 「破城槌」HPを1300->2300、ADを38->41、ARを150->180に変更。  
          - 「強化改良破城槌」HPを1800->3300、ARを180->230に変更。  
          - 双方にPerk"Battle Forged"を付与。  
        - その分敵としての出撃数と、生産速度とを減少。  
        - 破城槌のAIは、攻撃を受けても無視して前進して建物に取り付くことを試みるように変更。(というか修正？)
    
  - フレーバーテキストの追加  
    フレーバーテキストをモリモリ書くとゲーム中の視認性が悪くなるという困った問題があったのですが、これがシステム的に解決されました（後述）  
    そこで、今後は書けるだけフレーバーテキストを追加していく方針でいきます。  
  
  - 些末な変更  
    - スキル「滑空突撃」はシールドウォール中使えないように変更。
    - 数字回りの変更：  
      以下は負荷軽減上の理由からの変更です。
    - 内政研究のうち、荷車シリーズと魔術起重機の効果が微量増加。
    - 最適地形ボーナスのMS上昇量を+20%->+25%へ増加。
    - Perk「深呼吸」の回復効果を15から14へ変更。
    - Perk「重装マスタリー」の軽減効果を10%->12.5%へ変更。
  

### 各論
  
  - 武器の変更  
    - 「ハンドゴン」の増加ADを104->112へ変更。  
      改めて使ってみたら弱すぎたため。  
    - 「コンポジットボウ」の見た目を差し替え（やしおじ様からのご厚意による）。  
    - 「パラメリオン」のHitボーナスを8->10に変更（何故かパラメリオンだけ他の剣から数値がずれていたため調整）。
  
  - 盾の変更  
    以下は盾の仕様変更、つまり遠隔回避ボーナスの追加に対応する調整です。  
    基本的に近接回避が下がったものは遠隔回避が高め、近接回避が上がったものは遠隔回避が低めと考えてください。  
    装備で言われてもわからないと思われるため、主な装備兵士も書いておきます。
    - 「カイトシールド」の近接回避を22->18へ変更。  
    ...「帝国オルク重装支援兵」
    - 「ヒーターシールド」の近接回避を20->22へ変更。  
    ...ポテチ系歩兵全般
    - 「帝国の重楕円盾」の近接回避を18->19へ変更。
    ...帝国中ティアユニットすべて

  - スキルの変更  
    - 「マインドブラスト」にAPレート[50%]の魔法ダメージを設定。  
      相手によっては無駄なスキルと化していたため。  
      また、判定値も固定で+5強化。  
  
  - 竜族の変更  
    竜族は世界最高種族であり、最強!……なのはいいんですが、他のファクションとの差があまりに激しすぎるためほんの少しだけ微調整します。  
    単体の能力を落とすのではなく、ドラさんたちをもっと大切にして、より尊重することをプレイヤーに促すような形の調整を加えました。  
    - 全体変更  
      - すべての竜族ユニットは、選択文明が竜族でない場合はコストが+25%されるように変更。  
      - すべての竜族ユニットは、選択文明が竜族でない場合は生産速度が-12%されるように変更。  
        - 選択文明が竜族であっても、ナスン派以外の勢力では竜族ユニットの生産速度が-6%されるように変更。  
  
    - ナスン派の変更
      - ナスン派のみ文化の名前表示が変わるように変更。  
      - 勢力ボーナス「七色の龍帝」に生産速度ボーナス効果を明記。  
        数字としては今までと変わりません。  
      - 勢力ボーナス「七色の龍帝」のWillボーナス効果を+14->+9へ弱体化。  
  
    - 竜族ユニット個別の変更
      - ドラナ系ユニットの盾を「ヒーターシールド」から「ドラナシールド」へ変更。  
        盾の仕様変更で変に性能が変わらないようにするための措置。  
        また、グラフィックの関係上盾が破壊されていても視認できないのがよろしくないため、ほぼ壊れることのない金属盾化。  
        ドラナ氏族の皆さんはとことん初心者向けなので実質強化でも別に問題ないでしょう。  
  
  - 帝国の変更  
    - 「コロヌス・スケレトゥム」の作業効率を3%低下。想定よりも強力で崩壊が始まった後の帝国の内政を支えられてしまっていたため。  
    - **「帝国コロヌス属州農民」のコストを食料30->40へ値上げした上でほんの少しだけ出撃速度を低下**。  
      帝国のプレイヤーはRTS経験者のはずなのでどうってことないでしょう。ないよね？
    - 「帝国重スコルピオ」の最低射程を90pixから50pixへ変更。  
  
  - ルーリキアの変更  
    - Tier1盾兵を「ごろつき」から「民兵」へ変更。最序盤の弱体化。
    - 「ルーリキアベルゼルガ」の変更  
      - 基礎HPを+25。
    - 「ルーリキア選抜戦士」の変更  
      - 基礎HPを+40。
    - 「フローズンスリンガー」の変更  
      - SP回復量を10->12へ変更。  
      - 武器「エインヘリャル」の攻撃速度を35->52、ADを120->128へ変更。  
  
  - スシの変更  
    - 「オルク神風野郎」「オルク武将閣下」「ステップハーン護衛兵」「ステップ災厄騎兵」の生産速度を少し上昇。  
    - 「ゴブリン防人野郎」の変更  
      - HP+60, SP+10。
      - スキル「アンブッシュ」を削除。  
          下記の弩の性能変更に伴う調整。  
          数が揃うと凄まじい火力になりますが，どうせすぐ死んでしまうのでこれくらいのほうが面白いのではないでしょうか。  
    
      - 「三八式歩兵弩」の性能変更  
        - 三回連続で射撃を行うように変更。  
          また一発ごとの射撃SPコストを14->5に変更し，AA必要フレームを4->2に変更。  
        - 基本ADを65->58，ARpenを45%->35%,Hitボーナスを6->2，攻撃速度を50->27へ低下。  
          この武器は最初から連弩にする予定で作ったものでしたが，内部仕様的に実現に難があった関係で放置されたまま名前オチのしょぼい弩になっていました。  
          しかしながら，投射武器の仕様変更をもってついに連弩に。  
  
  - ポテチの変更  
    - Tier1盾兵を「民兵」から「ごろつき」に変更。最序盤を多少ましに。
    - 「ポテチ強盗騎士」はたまに馬鎧付きの軍馬に乗ってくるように変更。
  
  - その他兵士の変更  
    - 「傭騎兵」の食料コストを70->50へ変更。  
  
#### 演出の変更
  - 「スコーピオン」系の貫通ボルトにも影が付くように変更。  
  - 共通規格のユニットは状況に応じて瞬きをしたり表情が変化したりするように変更。  
  - 回避表示/盾等によるブロック表示よりもダメージ表示が優先的に表示されるように変更。  
  - 非低スペモード時は、建物にも奥行きによる色調補正表現が行われるように変更。  
  - 畑のスプライトが建築予定地の表示にピッタリハマるように変更。気になるという声があったため。
  - 騎手の位置を1pix高く、もう少し馬にフィットする位置になるように変更。  
    見た目だけです。  
  - 敵を撃破したユニットがもともと指示されていた方向を向くタイミングをより自然なものへと変更。  
  - 馬の疾駆表現を少し調整。

#### UI/UXの変更
  - 基本フォントサイズを変更。
  - パラメータにカーソルを合わせると変動した現在値が表示されるように変更。  
  - ドラッグ時の範囲表示レスポンスをより素早く変更。  
  - クリック時にマウスを動かすまではドラッグ選択モードに入らないように変更。  
  - マウスカーソルがユニットと重なっている時、クリックできるユニットが強調して表示されるように変更。  
    また、建物と重なってるユニットを選択できる際は、建物が半透明になるように変更。  
    作者は気にしていませんでしたが、この機能は実はかなり必要だった説があります…  
  - ユニット説明とフレーバーテキストを分離。  
    端的に言って視認性を欠いていたため変更。  
    Altキーを押すとフレーバーテキストを表示するようになります。  
    研究も同様に分離する予定ですが、ちょっとファイル仕様が異なるので後回し。  
  - 左上ウィンドウには現在の労働者の数が表示されるように変更。  
    当該UIの表示は地味に負荷がかかる処理なので抜本的に変える予定ですが、とりあえず。  
  - ファクション選択UIを変更。これも全てjs制御に置き換える予定なので暫定的変更です。  
  - 集団移動時のドラッグによる隊列向き変更のレスポンスが一拍遅れることがあったのをより高速に変更。
  - ユニット選択時の効果音を**仮**実装。ないよりはわかりやすいはず……  
  

#### パフォーマンス
おそらくv1.161の半分程度の軽さになりました。  
  - **並列処理ほぼ全てをリファクタリング**。  
  - **ユニット処理を再構築して抜本的に軽量化**。  
    恐ろしく軽くなります。逆にいうとこれ以上毎f処理されている処理を軽くするのは無理かも。  
  - 現在能力値計算をリメイクして軽量化。  
  - 描画処理を作り直して軽量化。  
  - マップスクリプトの処理を高速化。  
  - 建築物のミニマップ処理をさらに高速化。  
  - 各ユニットのチーム判定処理に無駄があったのを組み換え  。
  - 衝突判定を更に効率化。  
  - ミニマップ画像の編集元をキャッシュしておくように変更（アセット同梱版のみ反映）。  
  - 共通規格の頭画像ファイルのサイズが膨れ上がったのを考慮して、ゲーム開始時にキャッシュするように変更。  
  - 視界処理を完全リファクタリング。  
  - 単位ベクトルの生成式をより軽量なものに変更(まだ一部しか適用されていません)。  
  - 経路探索を最適化。  
    - ゲーム仕様上、6個までしかウェイポイントを保持できず、しかも6⃣個通過するごとに再検索していたDISの経路探索でしたが、js制御の導入によってデータが保持されるように。  
      アリーナ等での検索回数が減るはず。  
  - 戦闘ダメージ計算処理を高速化。  
  - 死亡時の処理高速化に着手（更なる改善の余地あり）  
  - ログメッセージの生成を**原則**1fに1回へ変更（大量のユニットが一気に倒された場合等も1fごとに順番に流れるようになります）  
    流れ方がちょっとかっこ悪くなりますが、パフォーマンス優先で。  
  - 演出用のユニットチェック処理の頻度を2fに1回から4fに1回へ変更。
  - 士気計算処理も高速化。
  - その他細かい計算を効率化。  
  
#### その他
  - 1fあたりのステップ数上限（内部コマンド実行数上限）をデフォルトの15万程度から300万へ変更。たまに起きていた再現性のない変な挙動はこれで改善されるかもしれません。  
  - リスタートボタンを一時的に消去。  
    元々挙動が怪しかったのですが、今回の組み換えで完全に壊れたため。  
  
## 修正
### v1.161からの修正:
#### 重篤なバグ
- スシの衝撃騎兵アップグレードが最終的にハーピー斥候に繋がってしまっていた不具合を修正(BETA2fix1)。  
- カメラを激しく動かすと攻撃範囲判定がおかしくなることがあったのを修正(BETA2fix1)  
- ユニットが何らかの要因でマップ外にはみ出ると無言でクラッシュしていた不具合..というより仕様，が発生しないように変更（BETA2prefix2）  
- 労働者ユニットと軍事ユニットを同時に選択した状態で、待機または操作指示を出すと凄まじい負荷を引き起こすことがあった不具合を修正。
- セーブ時に一部の重要な変数が初期化され、変な挙動を引き起こしていたのを修正(BETA3fix1)  
- 経路探索中にオートセーブがなされると、ユニット位置が破損することがあったのを修正。
- **カタフラクト等のAA範囲ダメージが二重に発動していた（！）のを修正**。(BETA3)
#### ユニットの不具合
- ルーリキアにおいて時代進化後に増設したTCで「属州総督の追放」が行えなかった不具合を修正。  
- 「規律」持ちの友軍ユニット（クルシラの儀仗兵等）が、実際には自分に押されている判定になっていたのを修正。  
#### AI挙動
- 破城槌系のユニットが他の種類のユニットの優先度を低く見るだけで，建物を特段重要視していなかったのを修正（BETA2prefix1）  
- 弾かれたユニットの思考が奇妙なことになることがあったのを修正（今度こそ）
#### 計算周り
- Perk"Strider"(馳夫)の効果が現実には生じていなかったのを修正(BETA3)
- 通常攻撃の対魔術師効果が回復ユニット相手に作用していた不具合を修正。(BETA3)
- Perk"Backstabber"及び"Unseen Threat"の効果がクリティカル時の計算に反映されていなかったのを修正。
#### 操作周り
- カメラを移動しながら経路探索をすると経路選択位置がズレていた不具合を修正。
- 建物一括選択時に、shift/ctrlを使わない予約を行うと、上手く生産予約が振り分けられなかった不具合を修正。(BETA3hotfix)
#### 表示/描画周り
- セーブロードを挟むと死体表示がおかしくなっていることがあった不具合が修正されました（Maniacs Patchの更新によって本体のバグが修正されたため。DIS製作者が能動的に解決したわけではありません）。  
- ファクションピック画面の記載が未だに崩れることがあったのを修正。  
- UIバフ・デバフ欄にマウスを重ねた際にUIが反応して詳細情報を表示する範囲が微妙にズレていたのを修正(BETA3)。  
- 友軍建物のキルや撃破数が，一部の友軍ユニットのキル数と撃破数に算入されてリザルトで表示されていた不具合を修正。  
- ユニット撃破時の倒れる向きがユニットの向き情報に依存していなかった不具合を修正。
- たまにセーブロードで上層ミニマップに書き込みがされて消えないことがあったのを修正(LDB書き換えにからむ処理順序変更が主因のため,開発環境以外は関係ないかも)  
- 壁建てる時の表示がマップによってズレていたのを修正 <- ただし対処療法
- 一部の街の中心の画像配置にズレがあったのを修正。  
- 「クロースアーマー」の歩行グラフィックにズレがあったのを修正。  
- 建築選択時、ASD欄の反応についてエフェクトが表示されるアイコンがひとつずつずれていたのを修正。  
- 研究ボタンを押すとたまに関係のないところが光っていた不具合を修正。  
#### 細かいモーション等
- 「バルディッシュ」に両手持ちモーションフラグがセットされていなかったのを修正。  
#### フォント周り
- 実績「もう終わりだよこの国」のフォント表記が崩れていた不具合を修正(BETA2fix1)。  
- ユニット生産時の補助テキストのフォントが崩れていたのを修正。(BETA3)  
- ステータス画面上部の表示フォントが崩れていたのを修正(BETA3)
- ユニットスキル説明の補助ウィンドウにおけるフォントが崩れていたのを修正(BETA3)
#### その他
- 2019年当時のテキストから変更されていたはずの内容がマップに反映されていなかったのを修正。  
  時事の状況がより酷くなって，当時のテキストはもう本当に洒落にならないことになってしまいました。どうしてこうなった。  
- 実績「ほぼFrozen Triggers」の取得条件がスシのユニットを倒したときに限定されていた不具合を修正。
- セーブデータロード時、復元処理が二重に行われていた不具合を修正(BETA3fix1)。  
- 帝国経済が崩壊したあとの音楽が音量設定に関係なく常に100％出力で鳴り響いていたのを修正。  
- クルシラの敵の経路がおかしくなっていたのを（おそらく）修正。


### BETA期間の修正:
- 通れないマップタイル判定が壊れていたのを修正(BETA1fix2)。
- マップのちょっとした押し出し処理のポインタ処理が壊れており，色々と奇怪なことが起きていたのを修正(BETA1fix2)
- 町の中心から出た労働者がちゃんと仕事してくれなくなっていたのを修正(BETA1fix2)
- 敵と交戦しているときの経路探索処理がバグってずっとその場を行ったり来たりしていたのを修正(BETA1fix3)
  ↑まだ直っていなかったのを修正(BETA2)
- 描画システム変更の影響で750体以上のユニットが出撃すると当たり判定を破損させていた不具合を修正(BETA1fix3)
- 弓騎兵が攻撃する際必ず馬が後ろを向いてしまっていた不具合を修正(BETA1fix3)
- 持ち替え後のユニットに戦術指示が一切できなくなっていた不具合を修正(BETA2prefix1)
- 歩きアニメモーションが微妙に変になることがあったのを修正(BETA2prefix1)
- 弓矢の射撃がカメラ移動に対応せず，ずれてしまっていた不具合を*今度こそ*修正(BETA2prefix1)
- 弓矢のパーティクルがポーズするとおかしなことになっていた不具合を修正(BETA2prefix1)
- マップ端の視界処理がおかしくなる不具合を修正(BETA2prefix1)
- ベクトル式組み換えの余波で投げ斧が明後日の方角へ飛んでいた不具合を修正(BETA2prefix1)
- 検索ＡＩの軽量化処理に瑕疵があり，全てのユニットが建物を最優先するようになっていたのを修正(BETA2prefix1)
- リスタート機能が破損していたのを修正(BETA2prefix2)
- 攻撃待機モーションよりも歩きの方が優先されていたバグを修正(BETA2prefix2)
- 渋滞時の押し出し判定が上手く機能していなかった不具合を修正(BETA2prefix2)
- 上の不具合の影響で不自然に歩行速度が遅くなることがあった不具合も修正(BETA2prefix2)
- 押し出し判定組み換えの影響でユニットがマップ外にはみ出やすくなっていたのを修正(BETA2prefix2)
- 戦闘中に謎の無言クラッシュが生じていた不具合を修正。原因となっていた変数の衝突の解決こそしましたが，触っていなかった箇所のため，何故衝突が始まったのかが不明（おそらくステップ数絡み）であり，この修正は対処療法的と言わざるを得ません。リファクタリングはもう少し続くかもしれません。(BETA2prefix2)
- 特定のオブジェクトをターゲットとした状態で経路探索を行うと目標地点が破損し，異常な頻度での経路探索が繰り返されていた不具合を修正。(BETA2prefix3)
- ユニット個別の情報画面における表示情報が崩壊していた不具合を修正。（BETA2fix1）
- 視界システムが作動しているマップで、ヴァイキング船を選択することが不可能かつ表示されない状態が発生していたのを修正。（BETA2fix2）
- 「ルーリキア木こり兵」「追いはぎ」が「木こりの大斧」を持たない素手の状態で出撃することがあった不具合を修正。（BETA2fix2）
- 「フローズンスリンガー」が「オブリビオン・ブリザード」を発動するとユニットデータが破損していた不具合を修正。（BETA2fix2）
- 定義されていないユニットの生成命令がなされたときに表示されるエラー文が、建物を選択して空欄になっている生産ボタンを押したときも出ていた不具合を修正。（BETA2fix2）
- 強制移動/攻撃指示を行ってもそれまで攻撃していたユニットをAIが優先して動いてしまうことがあったのを修正（BETA2fix2）。
- 矢の処理の不具合でユニット撃破時に無言でクラッシュすることがあったのを修正（BETA2fix2）。
- BETA版で試験的に導入していた新変数管理システムの根幹となるコマンド群に致命的なバグが発見されたため、これを全廃し安定版の処理にロールバック（BETA3）。
  - 上記が原因で発生していたＡＩ回りのバグを結果的に解決。
- スキル範囲外を指定した際に表示されていたインディケーターがv1.162BETAになってから出なくなっていたのを修正（BETA3）
- BETA3から経路探索が動かなくなっていたのを修正(BETA3)
- BETA2fix1でクラッシュの原因となっていた経路探索の不具合を修正（おそらく…）
- 待機中の味方ユニットに味方からの攻撃が当たるとおかしな挙動やクラッシュを引き起こすことがあった不具合を修正。
- 「ポテチ番兵」が倒された時、武器が転がる表現がなされていなかった不具合を修正(BETA3)。
- 一部の技術の説明文が文字化けしていた不具合を修正。
- アリーナで変なユニットが出ることがあった不具合を修正。（BETA3hotfix）
- 一部の兜の画像データが壊れており、クラッシュを誘発していた不具合を修正。(BETA3hotfix)
- スキル「ウィンドインパクト」のノックバック効果が消えていた不具合を修正。(BETA3hotfix)
- 内部ID870番以降のユニットに弾が命中すると、無限にヒットし続けていた不具合を修正。(BETA3hotfix)
- 服を着ていないときのゴブリンの半裸画像がセットされていなかったのを修正。(BETA3fix1)  
- 片手武器のの表示優先度設定が壊れて不安定になっていたのを修正。(BETA3fix1)  
- BETA3から一部の敵ユニットのAIが破損していた（クルシラ等で顕著）のを修正(BETA3fix1)
- 破城槌のAIがまた壊れていたのを修正。(BETA3fix1)
- 建物が破壊されたときの土埃エフェクトの出る位置がおかしかったのを修正。(BETA3fix1)
- ナスン派を選択していると勢力名表示が全部「天空新秩序」になっていたのを修正。
- 水上でチャプチャプしているエフェクトが出なくなっていたのを修正。
- 経路探索周りの変な挙動をほとんど完全に修正。
- 戦場の霧に包まれて見えないはずの部分がうっすら見えていた不具合を修正。
- 味方の建物を選択していてもHPバーが見えなくなっていた不具合を修正(ここまでBETA3fix2)。
- 武器に関わらず、対装甲有効率がすべて約800%になっていた不具合を修正。
- 消されていたはずの破城槌の防御モーションが再発していたのを修正。
- 待機指示が出されたはずのユニットが動きだすことがあったのを修正。
- 弓兵等の引き撃ちレスポンスがおかしくなることがあったのを修正。
- Iから見える詳細表示画面において兵士の表示が崩れることがあったのを修正(今度こそ)。
- 投擲系の武器の命中率計算が壊れていて基礎命中率がどんな場合でも26しかなかったのを修正。
(ここまでBETAFINAL)

### 既知の不具合：
- アリーナで変なユニットが出る（アリーナは近いうちにjsでまるごとリメイクするため対処しません）
- 情報画面のユニットスキルの数値表示がおかしい
- 100体以上のグリーンスキン兵士によるバンザイチャージがバグる

## プレイヤーにほぼ関係のない変更：
- デバッグモード時は起動時にログを生成するように変更。
- デベロッパーモード時はマップロード時に初期化プロセスのログを生成するように変更。
- マップエディタ機能着手
- RPGツクールシリーズの利用規約更新に対応したクレジット表記を追加。
- データcsvの文字コードがsjisになっていたので目についたところをutf8に変更。
- 日本語ファイルの文字コードのみsjis、他は基本的にutf8で読み込むように変更。
- 地形データをcsvで管理するように変更。
- スプライト命名規則をよりフレキシブルなものに変更。
- ピック可能な勢力の設定・Perk定義csvをModule内に格納し、将来的にいじりやすいように変更。
- 地形とPerk以外のデータベースcsvをモジュール内に格納。

