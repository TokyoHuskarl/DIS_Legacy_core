    v[401] = v[v[536]] - 1
	    v[301] = v[401] * v[1117] 
	    v[301] += 5001

	    Ptr1 = v[301]
	    v[Ptr1].copy v[601], 300

	    //@comment "Get [1-100]"
	    //@comment "モートン座標を記録するよ"
	    v[607].copy v[341], 2
	    v[341] .add v[53], 2
	    v[341] .sub v[76], 2
	    v[341] .div v[74], 2
	    //@comment "TT1=MortX
	    //TT2=MortY
	    //ビット演算して処理するよ"
	    v[341] = (v[341] | v[341] << 8) & 0xFF00FF
	    v[341] = (v[341] | v[341] << 4) & 0xF0F0F0F
	    v[341] = (v[341] | v[341] << 2) & 0x33333333
	    v[341] = (v[341] | v[341] << 1) & 0x55555555
	    v[342] = (v[342] | v[342] << 8) & 0xFF00FF
	    v[342] = (v[342] | v[342] << 4) & 0xF0F0F0F
	    v[342] = (v[342] | v[342] << 2) & 0x33333333
	    v[342] = ((v[342] | v[342] << 1) & 0x55555555) << 1
	    //@comment "yは1bitシフトで終わり"
	    //@comment "最後にTT1 OR TT2"
	    v[609] = v[341] | v[342]
	    //@comment "モートン座標を記録しおえたよ
	    //次はリストに登録するよ
	    //TT3=カウンター
	    //TT2=ポインター"
	    v[341] = v[609]
	    //@comment "#ルート空間だよ"
	    v[342] = v[1067] + v[v[1071]]
	    v[v[342]] = v[401] + 1
	    v[v[1071]] += 1
	    //@comment "#第5空間だよ
	    //0~1023"
	    v[343] = v[4538] + v[341]
	    v[v[341] * v[1004] + v[4535] + v[v[343]]] = v[401] + 1
	    v[v[343]] += 1
	    //@comment "#第四空間だよ
	    //0~255"
	    v[341] >>= 2
	    v[343] = v[4537] + v[341]
	    v[v[341] * v[1004] + v[4534] + v[v[343]]] = v[401] + 1
	    v[v[343]] += 1
	    //@comment "#第三空間だよ
	    //0~63"
	    v[341] >>= 2
	    v[343] = v[1074] + v[341]
	    v[v[341] * v[1004] + v[1070] + v[v[343]]] = v[401] + 1
	    v[v[343]] += 1
	    //@comment "#第二空間だよ
	    //0~15"
	    v[341] >>= 2
	    v[343] = v[1073] + v[341]
	    v[v[341] * v[1004] + v[1069] + v[v[343]]] = v[401] + 1
	    v[v[343]] += 1
	    //@comment "#第一空間だよ
	    //0~3"
	    v[341] >>= 2
	    v[343] = v[1072] + v[341]
	    v[v[341] * v[1004] + v[1068] + v[v[343]]] = v[401] + 1
	    v[v[343]] += 1
	    //@comment "モートン座標関係はこれで終わり"
	    v[301] -= 1
	    @if s[2] .isOff() { //optimizing 26.4.23
		    //@comment "Minions"
		    v[603] &= ~67108864
		    //@comment "#AA Timer"
		    @if v[628] > 0 {
			//@comment "AA on CD"
			v[628] -= v[843] != 1 ? v[871] : 0
			    
		    } .else bl {
			//@comment "AA可能"
			v[843] = v[843] <= 2 ? 0 : v[843]
			    
		    }
		    //@comment "Sub Timer"
		    //v[341] = v[301] + v[1059]
		    v[680] .sub v[1089], v[1060]
	    }
	    
	    //@comment "目標位置"
	    //v[641] = v[301] + 41
	    //v[619] = v[301] + 19
	    //v[628] = v[301] + 28
	    //v[620] = v[301] + 20
	    //@comment "WPのずれを一括で修正"
	    v[641] .add v[1021], 14
	    v[641].copy v[619], 2
	    //@comment "Obj指定分岐
	    //Get18 = 目標ObjID"
	    //@comment "TEST"
	    s[103..104].off
	    Ptr8 = v[618] * 300 
	    //@comment "強制移動指示があればGet18=0"
	    @if v[842] != 4 {
		v[618] = v[842] == 3 ? 0 : v[618]
		@if v[618] >= 1 { 
		    //@comment "Obj指定があり、そちらに行きたいとき
		    //Get18 = 目標ObjID"
		    //Ptr8 = Get18*300
		    v[304] = Ptr8+4701
		    @if v[v[304]] >= 1 {
			//@comment "#Target Switched"
			@if v[v[304]] != v[631] {
			    @if `!(v[603] & 4194304) {
				@if `v[634] & 49152 {
				    v[842] = 2
				    @if `!(v[603] & 8388608) {
					v[634] |= 2097152
					
				    }
				    
				}
				
			    }
			    
			}
			@if `v[655] >= 1 && (v[842] == 3 || v[841] == 2) || v[842] > -1 && v[841] == 1 {
			    //@comment "#移動優先"
			    v[641].copy v[619], 2
			    
			} .else bl {
			    //@comment "#目標OBJ優先"
			    v[304] += 6
			    v[v[304]].copy v[619], 2
			    @if v[841] == 2 {
				v[842] = 2
				v[v[304]].copy v[641], 2
				
			    }
			    //@comment "T35=目標Objの幅*1000"
			    v[335] = v[v[304] + 3] * 1000
			    s[103].on
			    
			}
			
		    } .else bl {
			//@comment "#指定Objが存在しない"
			v[603] |= 134217728
			v[634] &= ~2097152
			//@comment "if AA Timer <1"
			//@comment "#攻撃指令モードであれば、その場で警戒モードに移行"
			@if v[841] == 2 {
			    @if `v[634] & 131072 {
				v[841] = 4
				
			    } .else bl {
				v[641].copy v[619], 2
				v[841] = 0
				//@comment "Set searching for enemy flag"
				v[603] |= v[603] & 2097152 ? 0 : 1048576
				
			    }
			    
			}
			//@comment "#WPを使ってOBJにたどり着こうとしていた"
			@if `v[603] & 16777216 {
			    //v[341] = v[301] + 43
			    v[1301].copy v[643], 13
			    v[603] &= ~16777216
			    v[634] &= ~49152
			    
			}
			@if v[629] <= 0 {
			    //@comment "#Obj目標を消す"
			    v[618] = 0
			    v[847] = 0
			    v[634] &= ~(16384 + 8388608)
			    @if v[655] < 1 {
				v[607].copy v[619], 2
				@if v[841] == 4 {
				    //@comment "#操作モードならその場をホールド"
				    v[607].copy v[641], 2
				    
				} .else bl {
				    @if v[841] == 0 {
					//@comment "//#警戒モードならその場をホールド"
					v[607].copy v[641], 2
					
				    } .else bl {
					@if v[841] == 3 {
					    //@comment "#防御モードor having Waypoint であれば、HoldPointへ戻る#"
					    v[641].copy v[619], 2
					    v[845] = 1
					    v[842] = 2
					    
					}
					
				    }
				    
				}
				
			    } .else bl {
				v[641].copy v[619], 2
				v[842] = 2
				
			    }
			    
			}
			
		    }
		    v[631] = v[618]
		    @if `!(v[Ptr8 + 4703] & 67108864) {
			//@comment "目標地点にカメラのずれを加算"
			v[619] .add v[53], 2
			
		    }
		    
		} .else bl {
		    //@comment "#WPを使ってOBJにたどり着こうとしていた"
		    @if `v[603] & 16777216 {
			v[1301].copy v[643], 13
			v[842] = 2
			v[603] &= ~16777216
			v[634] &= ~49152
			
		    }
		    //@comment "has WP"
		    v[842] = v[655] > 0 && v[842] < 3 ? 1 : v[842]
		    
		}
		
	    }
	    v[603] |= 67108864
	    //@comment "Temp4 = 次に動く場所x
	    //Temp6 = 次に動く場所y"
	    v[304] = pow(v[309] = v[619] - (v[607] + v[53]), 2)
	    //@comment "#######"
	    //optimizing 25.4.23
	    //v[304] += v[306] = pow(v[310] = v[v[620]] - (v[v[301] + 8] + v[54]), 2)
	    v[306] = pow(v[310] = v[620] - (v[608] + v[54]), 2)
	    v[304] += v[306]
	    //@comment "Set Object[23]"
	    //v[300] = v[301] + 23
	    v[623] = sqrt(v[304], 1000)
	    v[318] = v[623]
	    /*@comment "#############
	    ここ配列操作で高速化可能
	    #############"*/
	    v[342] = v[603] & 16 ? 9 : 2

 	    
	    //v[300] = v[301] + 22
	    v[622] = (v[622] * v[342] + v[310] * 100000 / v[318]) / (v[342] + 1)
	    //v[300] = v[301] + 21
	    v[621] = (v[621] * v[342] + v[309] * 100000 / v[318]) / (v[342] + 1)
	    v[621].copy v[319], 2

	    @if v[842] != 4 {
		@if s[2] .isOff() {
		    @if s[103] .isOn() {
			v[845] &= ~1
			//@comment "Objに向かっているときは"
			//@comment "Set Dir"
			v[844] = v[Ptr8 + 4707] - v[607] >= 0 ? 0 : 1
			//@comment "AAレンジ内か否かを見る"
			//v[295] = v[301] + 269
			v[869].copy v[341], 2
			//@comment "自分がMelee or townsman repairingなら([相手の幅]*1000)を引いて考える"
			v[340] = v[318]
			v[340] -= v[703] == 0 || v[847] == 6 ? v[335] : 0
			//@comment "If the target is build basement"
			v[340] -= v[Ptr8 + 4703] & 32 && v[Ptr8 + 4701] == 11 ? v[Ptr8 + 4938] * 1000 : 0
			@if v[340] <= v[341] {
			    @if v[340] >= v[342] {
				//@comment "#WPを使ってOBJにたどり着こうとしていた"
				@if `v[603] & 16777216 {
				    //v[341] = v[301] + 43
				    v[1301].copy v[643], 13
				    v[634] &= ~49152
				    
				}
				s[104].on
				v[842] = -1
				//@comment "Not casting skill"
				@if `(v[843] >= 4 || v[628] > 0) != 1 {
				    //@comment "AAタイマー見る"
				    v[843] = 1
				    /*@comment "#＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃
				ここの調節でゲームスピードが決定する
				#＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃"*/
				    v[628] = v[721] > v[708] && v[726] & 2048 ? AA_WAIT_FPSx2 : AA_WAIT_FPSx1
				    
				}
				
			    } .else bl {
				//@comment "If closer than minimum range"
				@if v[841] == 1 {
				    //@comment "#待機モード時はその場で待ち構える"
				    s[104].on
				    v[842] = -1
				    
				} .else bl {
				    s[104].off
				    v[842] = 11
				    //@comment "#Flip flag"
				    v[874] |= 1024
				    //@comment "#Kite flag"
				    v[726] |= 33554432
				    
				}
				
			    }
			    
			} .else bl {
			    s[104].off
			    @if v[841] == 1 {
				//@comment "#待機モード時はその場で待ち構える"
				s[104].on
				v[842] = -1
				
			    } .else bl {
				v[842] = 1
				
			    }
			    
			}
			
		    } .else bl {
			//@comment "If the unit is not in any fighting situation, Set OffsetX = 0"
			v[896] = 0
			//@comment "before: 6700"
			//v[340] = v[v[294]] > 0 ? (v[610] / 2 + 2) * 1000 : 6700
			//this part was bugged since v[294] wasn't defined inititally - 9.5.23
			v[340] = v[655] > 0 ? (v[610] / 2 + 2) * 1000 : 6700
			@if v[318] <= v[340] {
			    //v[294] = v[301] + 55
			    //@comment "候補なし"
			    s[204].off
			    //@comment "敵がおらん"
			    //@comment "待機"
			    //@comment "強制移動指示"
			    //@comment "またはWPがある"
			    @if `v[618] == 0 || (v[841] == 1 || v[841] == 3 || v[842] == 3 || v[655] > 0) {
				//@comment "WPがあるならWP処理"
				@if v[655] > 0 {
				    //@comment "#301 = 5000+(300*ID)"
				    v[299] = 641
				    v[298] = 643
				    @loop 6 {
					v[v[298]].copy v[v[299]], 2
					v[298..299] += 2
					
				    }
				    
				    //@comment "後ろに0代入"
				    v[1301].copy v[v[299]], 2

				    //@comment "#WPへらす"
				    v[845] &= ~1
				    v[655] -= 1
				    s[204].on
				    @if v[655] <= 2 {
					@if `!(v[603] & 4194304) {
					    @if `v[634] & 49152 {
						v[842] = 2
						
					    }
					    
					}
					
				    }
				    
				}
				@if v[655] == 0 {
				    v[603] &= ~16777216
				    @if `v[634] & 32768 {
					v[634] |= 16384
					
				    }
				    s[204].on
				    v[845] = 0
				    v[655] -= 1
				    
				}
				v[634] &= ~12288
				
			    }
			    @if s[204] .isOff() {
				v[634] &= ~49152
				v[603] &= ~(4194304 + 33554432)
				v[844] = (cos(v[656], 1000, -100) + 200) / 200
				s[104].on
				@if `!(v[603] & 64) {
				    //@comment "防御"
				    @if v[841] == 3 {
					//@comment "地点に戻った"
					v[845] &= ~1
					v[655] = -2
					v[842] = -2
					
				    } .else bl {
					//@comment "待機"
					v[842] = v[841] == 1 ? -2 : -1
					
				    }
				    
				} .else bl {
				    //@comment "Got Collision Problem"
				    v[603] |= 128
				    //@comment "Stop Forcemove"
				    //opt 26.4.23
				    //v[v[842]] -= v[v[842]] == 3 ? 1 : 0
				    v[842] -= v[842] == 3
				}
				
			    }
			    
			} .else bl {
			    @if `(v[603] & 64 + 256) == 0 {
				@if v[842] <= -1 {
				    @if `v[841] == 3 || v[841] == 1 {
					s[104].off
					v[842] = 1
					
				    }
				    
				}
				
			    }
			    
			}
			
		    }
		    
		}
		//@comment "移動処理テスト"
		//v[300] = v[301] + 12
		//v[299] = v[301] + 21
		//v[298] = 311
		//v[297] = v[301] + 242
		//@comment "とまる"
		@if v[842] <= -1 {
		    s[104].on
		    v[845] = 1
		    //@comment "hovering"
		    @if `v[603] & 1024 {
			v[850] = 3
			s[104].off
			v[1301].copy v[621], 2
			
		    }
		    
		}
		//@comment "移動"
		v[845] = between(v[842], 2, 3) ? 0 : v[845]
		//@comment "Attacking"
		@if v[843] == 1 {
		    //@comment "#Set ForceSprite Attack"
		    v[850] = 1
		    v[845] = v[629] > 0 ? 1 : 0
		    s[104].on
		    
		} .else bl {
		    @if `v[603] & 16 {
			s[104].off
			
		    }
		    
		}
		//@comment "flee check"
		v[842] = v[874] & 512 ? 11 : v[842]
		@if s[104] .isOn() {
		    //@comment "動かない"
		    //@comment "待機"
		    v[1301].copy v[612], 2
		    
		} .else bl {
		    v[341] = v[842] == 11 ? -1 : 1
		    //v[0] = v[612..613] = [v[621] * v[868] * v[341], v[622] * v[868] * v[341]]
		    v[612] = v[621] * v[868] 
		    v[613] = v[622] * v[868] 
		    v[612..613] *= v[341]
		    //@comment "#WalkingSwitchOn"
		    //v[0] = s[v[4558] + v[401]] = 1
		    v[341]=v[4558] + v[401]
		    s[v[341]].on
		}
		
	    } .else bl {
		@if s[2] .isOff() {
		    //@comment "nowall"
		    v[603] &= ~8388608
		    //v[341] = v[301] + 249
		    v[849] -= 1
		    @if v[849] < 1 {
			@if `v[603] & 1048576 {
			    @if `v[841] == 2 {
				v[842] = 2
				
			    } .else bl {
				v[842] = v[603] & 4194304 ? 3 : 2
				
			    }
			    
			} .else bl {
			    v[842] = 2
			    
			}
			
		    }
		    
		}
		
	    }
	    //@comment "座標ずらし"
	    //~v[300] = v[301] + 5
	    //v[299] = v[301] + 12
	    //v[298] = v[301] + 7
	    //v[297] = 53
	    //v[296] = v[301] + 36
	    //v[295] = v[301] + 296
	    //v[294] = v[301] + 15
	    /*@comment "#壁衝突チェックパート
	#自己x 311
	#自己y 312
	#保存x*10000 303
	#保存y*10000 304*/
	    v[605].copy v[311], 2
	    v[311] .add v[1061], 2
	    v[311].copy v[303], 2

	    //v[311..312] /= 10000
	    //@comment "ずれ計算"
	    //24.4.23
	    macro_cord_diff(v[311] v[312])
	    //macro_diff_var311to312()
	    /*
	    v[311] .sub v[403], 2
	    v[311] .add v[53], 2
	    //@comment "ずれおわり"
	    v[311..312] /= 16*/

	    //@comment "set mapXY"
	    //v[293] = v[301] + 26
	    v[311].copy v[626], 2
	    /*@comment ######################
	Get Terrain and Elevation info*/

	    //changed 11.5.23
	    //v[313] = v[v[1182] + v[311] - v[69] + (v[312] - v[70]) * v[2061]]
	    v[311].sub v[69],2
	    TT1 = v[312] * v[2061]
	    v[632] = v[311] + TT1//map point saved

	    // set v313 as a pointer to map tile
	    v[313] = v[1182] + v[632]

	    v[657] = v[v[313]] / 100000000
	    v[640] = v[v[313]] % 100


	    //@comment "######################"
	    //@comment "#移動先壁チェック"
	    v[303] .add v[612], 2
	    
	    //v[303..304] /= 10000
	    //24.4.23
	    //macro_diff_var303to304()
	    macro_cord_diff(v[303] v[304])
	    /*
	    //@comment "ずれ計算"
	    v[303] .sub v[403], 2
	    v[303] .add v[53], 2
	    //@comment "ずれおわり"
	    v[303..304] /= 16*/

	    v[313] = v[v[432] + v[303] + (v[312] - v[70]) * v[2061]] % 100
	    v[314] = v[v[432] + v[311] + (v[304] - v[70]) * v[2061]] % 100
	    v[313..314] /=20
	    v[315] = (v[313] + v[314]) 
	    v[315] %= 2

	    @if s[2] .isOff() {
		v[612] .add v[615], 2
		v[1301].copy v[615], 2
		@if v[315] == 0 {
		    //@comment "nowall"
		    v[315] = v[v[432] + v[303] + (v[304] - v[70]) * v[2061]] % 100
		    //@comment "斜め壁Ck"
		    //@comment "##壁がなければ速度を足す"
		    @if v[315] < 21 {
			//@comment "#Agent can move onward"
			@if v[842] > 1 {
			    //@comment "#Then break wall detection flag"
			    v[603] &= ~8388608
			    
			}
			v[605] .add v[612], 2
			
		    } .else bl {
			v[603] |= 8388608
			
		    }

			//get v[v[297]] to v[341]
			v[53].copy v[341], 2
			v[341] .mul v[4813], 2
			//add to v[v[300]]
			v[605] .add v[341], 2
			v[605].copy v[607], 2
			//div
			v[607] .div v[4813], 2
			v[636] = v[607] + v[896]
			v[637] = v[608] + v[897]
		
		    
		} .else bl {
		    //@comment "wall detection"
		    v[603] |= 8388608
		    //@comment "##20以上で壁がある"
		    v[341] = v[868] * 100
		    //@comment "##垂直方向に壁があれば進行方向vにMSかけたものが速度に"
		    v[342] = abs(v[612])
		    @if v[313] < 21 {
			//@comment "##壁がなければ速度を足す"
			v[605] += v[612]
			
		    } .else bl {
			v[612] = divmul(v[612], v[342], v[341])
			
		    }
		    //@comment "#カメラずらして"
		    v[605] += v[53] * 10000
		    //@comment "#座標を反映"
		    v[607] = v[605] / 10000
		    v[636] = v[607] + v[896]
		    //@comment "Y座標"
		    //v[295..300] += 1
		    //@comment "##垂直方向に壁があれば進行方向vにMSかけたものが速度に"
		    v[342] = abs(v[613])
		    @if v[314] < 21 {
			//@comment "##壁がなければ速度を足す"
			v[606] += v[613]
			
		    } .else bl {
			v[613] = divmul(v[613], v[342], v[341])
			
		    }
		    //@comment "#カメラずらして"
		    v[606] += v[54] * 10000
		    //@comment "#座標を反映"
		    v[608] = v[606] / 10000
		    v[637] = v[608] + v[897]
		    
		}
		@if `v[603] & 8388608 {
		    @if v[841] == 2 {
			v[634] |= 16384
			
		    }
		    
		}
		
	    } .else bl {
	       /*v[295..300] -= 1
		@loop 2 {
		    v[295..300] += 1
		    //@comment "#カメラずらして"
		    v[v[300]] += v[v[297]] * 10000
		    //@comment "#座標を反映"
		    v[v[298]] = v[v[300]] / 10000
		    v[v[296]] = v[v[298]] + v[v[295]]
		    //@comment "Y座標"
		    
		}*/ 
		//@comment "#カメラずらして"
	        v[605] += v[53] * 10000
		//@comment "#座標を反映"
		v[607] = v[605] / 10000
		v[636] = v[607] + v[896]
		//@comment "#カメラずらして"
		v[606] += v[54] * 10000
		//@comment "#座標を反映"
		v[608] = v[606] / 10000
		v[637] = v[608] + v[897]
		
		
		
	    }
	    //v[295..300] = 0
	    //@comment "Overwrite ActionState "
	    @if v[846] > 0 {
		v[843] = v[846] + 3
		
	    }
	    /*@comment "#############
	    #Set Y Position EV
	    #############"*/
	    v[348] = v[401] + 501
	    
	    //Set Obj into Drawing List

	    //opt 29.4.23
	    s[v[348]].off
	    @if `s[2001+v[401]] != 0 {
	    	//v[345] = v[301] + 7
		@if v[607] >= v[1008] {
			@if v[607] <= v[1009]{
				//v[346] = v[301] + 8
				@if v[608] >= v[1010]{
					@if v[608] <= v[1011]{
						//24.4.23
						//v[0] = v[v[301] + 36..v[301] + 37] += v[v[301] + 281..v[301] + 282]
						//v[636] += v[v[301] + 281]
						//v[637] += v[v[301] + 282]
						v[636] .add v[881], 2
						//@comment "#描画範囲内であれば保存"
						//@comment "#画面外"
						//@comment "+[Const描画ymax]"
						s[v[348]].on
						//@comment "Will_be_depicted"
						v[v[1112] + v[184]] = (v[608] + v[611] + v[1011]) * 1000 + v[401]
						v[v[1113] + v[184]]= v[401]

						v[184] += 1

						func_blink_set() //check blink only when it's in screen
					}
				}
			}

		}
	    }


	func_main_save_agent_vars()
