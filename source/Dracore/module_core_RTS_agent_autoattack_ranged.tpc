
cev .id(36), .name("AgentAct:RangedAA_Shot"), {
	// "Access19 = AttackerObjectIDAccess20 = TargetObjectID"
	v[299] = v[207] + 1
	v[300] = v[v[300]]
	// "対象Objがある"
	@if v[300] >= 1 {
	    // "ObjTypeチェック"
	    v[298] = 300 * v[300] 
	    v[298] += 4701
	    // "攻撃モーション処理"
	    v[720] = v[210] + 120
	    v[629] = v[210] + 29
	    v[726] = v[210] + 126
	    v[v[726]] |= (v[v[726]] & 50331648) == 50331648 ? 67108864 : 0
	    //v[v[726]] |= (v[v[726]] & 50331648) == 50331648 ? 67108864 : 0
	    // "ObjTypeチェック"
	    s[202..203].off
	    @if v[v[298]] > 0 {
		@if v[v[629]] >= v[v[720]] {
		    @if v[243] < v[1017] {
			// "射撃成功！"
			// "#Auto Attack SP Cost"
			v[0] = v[v[210] + 108] = max(v[v[210] + 108] - v[v[210] + 121], 0)
			// "#親Objと対象Objをセット"
			v[609] = v[299]
			v[623] = v[300]
			// "#始点を設定"
			v[607] = v[210] + 7
			v[v[607]].copy v[607], 2
			// "#終点を設定"
			v[624] = v[298] + 6
			v[v[624]].copy v[624], 2
			// "#diffusionf: y=x (x)/(-240)+30"
			v[350] = max(pow(v[v[210] + 265], 2) / -240 + 30, 0)
			v[0] = v[624..625] += [rnd(-v[350], v[350]), rnd(-v[350], v[350])]
			// "#フレーム数を設定"
			v[700] = v[v[210] + 128]
			v[603] = v[700] - 1
			/*9.3.23
			v[700] = v[210] + 128
			v[603] = v[v[700]] - 1
			v[700] = v[v[700]]*/
			v[729] = v[210] + 129
			v[729] = v[v[729]] > 90 ? v[v[729]] : 91
			v[637] = v[v[210] + 244]
			s[141].on
			v[607].copy v[361], 2
			@call .cev v[729]
			v[842] = v[210] + 242
			v[v[842]] = 0
			v[843] = v[210] + 243
			// "AAクールタイムモーション"
			v[726] = v[210] + 126
			// "ビット見る"
			v[341] = v[v[726]] & 1
			v[v[843]] = v[341] == 1 ? 2 : 0
			// "AAモーション初期化"
			v[629] = v[210] + 29
			v[v[629]] = 0
			// "Initialize AI Timer"
			v[v[210] + 84] = v[v[210] + 300] % v[1195]
			v[v[210] + 80] = v[1240] * v[4571] / 2
			
		    } .else bl {
			s[202].on
			s[203].off
			
		    }
		    
		} .else bl {
		    v[v[629]] += 1
		    
		}
		
	    } .else bl {
		s[202].on
		s[203].off
		
	    }
	    
	} .else bl {
	    s[202].on
	    s[203].on
	    
	}
	@if s[202] .isOn() {
	    @if s[203] .isOn() {
		v[v[210] + 242] = 0
		
	    }
	    v[v[843]] = 0 // ACHTUNG given from Action
	    // "#AAタイマー初期化"
	    v[v[210] + 28] = 0
	    
	}
}

cev .id(31), .name("AgentAct:RangedAA_Check"), {



	// "Leave Arrow Picture"
	v[v[301]] = 1
	// "エフェクト処理から呼び出される"
	v[341] = v[301] + 8
	v[342] = v[301] + 22
	/* "Access19 = AttackerObjectID
	Access20 = TargetObjectID
	Access18 = TargetObjTypeチェックPtr"*/
	v[299] = v[v[341]]
	v[300] = v[v[342]]
	Ptr10 = Ptr20*300
	Ptr9 = Ptr19*300
	v[298] = Ptr10 + 4701
	// "TargetObjが存在している"
	@if v[v[298]] >= 1 {
	    // "処理開始"
	    v[607] = v[301] + 6
	    // "#着弾点ゲット"
	    v[v[607]].copy v[607], 2
	    // "#対象のx,y,width,heightゲット"
	    v[310] = v[298] + 6
	    v[v[310]].copy v[310], 2
	    v[312] = v[298] + 9
	    v[v[312]].copy v[312], 2
	    // "#当たり判定チェック"
	    @if `between(v[607], v[310] - v[312], v[310] + v[312]) && between(v[608], v[311] - v[313], v[311] + v[313]) {
		s[167].off
		@if `v[Ptr10 + 4701] == UNIT_CLASS_STATIC {
		    s[167].on
		    
		}
		v[Ptr10 + 4780] = v[1240] * v[4571]
		// "Get difference of elevationTemp20"
		v[320] = v[Ptr9 + 4757] - v[v[298] + 56]
		v[11] = v[299]
		// "Get Dir"
		@if s[167] .isOff() {
		    //9.3.23
		    v[13] = v[v[301] + 36]
		    //@call .cev 43
		    func_bs_ranged_hit_check(v[299] v[300] v[13])
		    v[607] = v[210] + 7
		    v[v[607]].copy v[607],2
		} .else bl {
		    v[21] = 1
		    
		}
		@if v[21] == 1 {
		    // "Hit!"
		    // "#CheckCrit"
		    // "Var1 = Obj 1~V[421] = ダメージ倍率"
		    @if s[167] .isOff() {
			v[11] = v[299]
			v[15] = Ptr10 + 4700
			// "#Crit率ゲット"
			// "#3-CritReduction"
			v[342] = v[v[11] * 300 + 4815] + 2 - v[v[15] + 239]
			v[341] = rnd(0, 99)
			// "#CritDamageReduction#(450-[Reduction])%"
			v[343] = 450 - v[v[15] + 240]
			// "#[Crit]%でフラグ"
			v[421] = v[342] >= v[341] ? v[343] : 100
			
		    } .else bl {
			v[421] = 100
			
		    }
		    // "#Elevation Bonus"
		    v[421] += 10 * v[320]
		    /* "＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃
	ここそのうち用意した関数に置き換える
	＃＃＃＃＃＃＃＃＃＃＃＃＃＃＃"*/
		    // "ADを取得"
		    /*v[11] = v[299]
		    v[12] = 1
		    @call .cev 2004*/
		    macro_get_agent_slot_to_r1(v[299] SLOT_CURRENT_AD)
		    v[301] = v[21]
		    // "ARかMRか取得"
		    v[722] = Ptr9
		    v[722] += 4822
		    v[302] = v[v[722]]
		    // "射撃属性"
		    v[303] = 1
		    // "AABits"
		    v[19] = v[722] + 2
		    v[19] = v[v[19]]
		    //@call .cev 40
		    func_damage_calculation()
		    // "############"
		    // "Effect"
		    // "#あたったので演出チェック"
		    @if `s[v[300] + 500] == 1 {
			@if v[21] == v[22] {
			    // "Red Flash"
			    v[376] += v[182] < 5 ? 1 : 0
			    @if v[376] >= 2 {
				v[182] += 1
				v[329] = rnd(0, 2)
				// "#########################"
				v[472] = divmul(60, 100, v[2216])
				v[473] = rnd(90, 110)
				v[474] = divmul(v[607] + v[1001], v[1281], 50)
				t[510] .asg "arrow_hit_body_"
				t[510] .cat v[329]
				v[341] = 510
				// "Strings = t[v[341]]"
				@cmd 11550, t[v[341]], .args v[472], 3
				// "#########################"
				// "Get MaxHP of the victim"
                   		v[343] = v[v[342] = Ptr10 + 4805] / 10
				v[342] = rnd(0, 9)
				// "if the damage amount is higher than 10% of max HP of the victim more likely bleed effect happens"
				v[342] += v[343] < v[22] ? 3 : 0
				v[342] *= v[243] < v[1124] ? 1 : 0
				@if v[342] >= 8 {
				    v[711] = Ptr10
				    v[607] = v[711] + 4707
				    v[v[607]].copy v[607], 2
				    //s[141].on
				    v[372] = v[Ptr10 + 4840] & 4096 ? 1 : 0
				    //@call .cev 111
				    v[14] = v[22] >= mini_blood_damage_threshold ? 0 : 1
				    func_call_mini_blood_f_effect(v[361] v[362] v[372] v[14])
				    
				}
				
			    }
			    
			} .else bl {
			    // "#########################"
			    v[472] = divmul(45, 100, v[2216])
			    v[473] = rnd(80, 95)
			    v[474] = divmul(v[607] + v[1001], v[1281], 50)
			    @cmd 11550, "arrow_hit_armor", .args v[472], 3
			    // "#########################"
			    
			}
			
		    }
		    // "Remove Arrow Picture"
		    v[310] = v[241] + v[1220]
		    @pic[v[310]].erase
		    // "#試作#Functionを呼ぶ"
		    v[295] = Ptr9
		    v[295] += 4700
		    v[730] = v[295] + 130
		    @if v[v[730]] >= 1200 {
			v[341] = v[295] + 7
			v[v[341]].copy v[590], 2
			@call .cev v[v[730]]
			
		    }
		    
		} .else bl {
		    // "Miss!"
		    v[607].copy v[221], 2
		    @if `s[v[300] + 500] == 1 {
			@if v[22] == 1 {
			    // "Shield Blocked!"
			    // "#########################"
			    v[472] = divmul(60, 100, v[2216])
			    v[473] = rnd(115, 120)
			    v[474] = divmul(v[607] + v[1001], v[1281], 50)
			    @cmd 11550, "重いパンチ2", .args v[472], 3
			    // "#########################"
			    // "Call Shield"
			    v[342] = Ptr10 + 4952
			    // "NOT siege ram"
			    @if `v[v[342] - 123] != 100 {
				v[v[342] + 32] = v[v[342]] > 0 ? 4 : 0
				// "#Shield Motion"
				v[342] = Ptr10 
				v[342] += 4943
				@if v[v[342]] != 1 {
				    v[v[342]] = 2
				    v[342] -= 215
				    v[v[342]] += v[v[342]] < 300 ? 900 : 0
				    
				}
				
			    }
			    @if s[307] .isOff() {
				@if `v[183] < v[4572] / 2 {
				    // "#描画範囲内か？"
				    v[220] = ((v[220]+1)%30)+1201
				    //9.3.23
				    //v[220] += 1201
				    //v[220] += 1
				    v[223] = v[220]
				    v[221] += rnd(-6, 6)
				    v[222] += rnd(-3, 3)
				    v[222] += s[162] == 1 ? 10 : 0
				    // "#サイズは最低100%"
				    v[225] = 100
				    // "AR"
				    v[341] = v[1204] - 10
				    @pic[v[223]].show {
					"num\num_block"
					.pos v[221], v[222] .center
					.scrollWithMap
					.chromakey 1
					.scale v[225]
					.trans v[341]
					.rgbs 100, 100, 100, 100
					.mapLayer 7
					.eraseWhenTransfer
					.affectedByFlash
					.affectedByShake
				    }
				    v[222] = v[608] - 24
				    v[222] += s[162] == 1 ? 10 : 0
				    @pic[v[223]].move {
					.pos v[221], v[222] .center
					.scale v[225]
					.trans 100
					.time 12
					.rgbs 100, 100, 100, 100
				    }
				    v[183] += v[184] >= v[1128] ? 2 : 1
				    
				}
				
			    }
			    // "Remove Arrow Picture"
			    v[310] = v[241] + v[1220]
			    @pic[v[310]].erase
			    
			} .else bl {
			    @if s[307] .isOff() {
				@if `v[183] < v[4572] / 2 {
				    // "#描画範囲内か？"
				    v[220] %= 30
				    v[220] += 1201
				    v[220] += 1
				    v[223] = v[220]
				    v[221] += rnd(-6, 6)
				    v[222] += rnd(-3, 3)
				    v[222] += s[162] == 1 ? 10 : 0
				    // "#サイズは最低100%"
				    v[225] = 100
				    // "AR"
				    v[341] = v[1204] - 10
				    @pic[v[223]].show {
					"num\num_miss"
					.pos v[221], v[222] .center
					.scrollWithMap
					.chromakey 1
					.scale v[225]
					.trans v[341]
					.rgbs 100, 100, 100, 100
					.mapLayer 7
					.eraseWhenTransfer
					.affectedByFlash
					.affectedByShake
				    }
				    v[222] = v[608] - 24
				    v[222] += s[162] == 1 ? 10 : 0
				    @pic[v[223]].move {
					.pos v[221], v[222] .center
					.scale v[225]
					.trans 100
					.time 12
					.rgbs 100, 100, 100, 100
				    }
				    v[183] += v[184] >= v[1128] ? 2 : 1
				    
				}
				
			    }
			    
			}
			
		    }
		    
		}
		
	    }
	    
	}
	s[141].off


}
