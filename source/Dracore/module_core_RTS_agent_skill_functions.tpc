//cev 2006 


//cev 2008 CkIfSklCall v1v2 r1
//IF this function returned 1 in reg1, it means the $agent cannot cast $skill for some reason
__fn func_CkIfSklCall $agent $skillno {
	/*@comment "Var1 = Obj 1~
	Var2 = SkillNo
	r1 = Cant_call_skill
	"*/	

	reg1 = 0
	v[341] = $agent * 300
	Ptr1 = v[341] + 4701
	v[Ptr1].copy v[601],300
	//@comment "#Is the ordered skill registered to the obj?"
	
	//v[342] = v[341] + 4821 
	//v[342] += ($skillno * 20)
	v[342] = 721
	v[342] += ($skillno * 20)

	//EXTRACT SKILL PARAMETER
	v[v[342]].copy skill_ID,20

	/*9.3.23 kick out needless var v[343]
	v[343] = $skillno * 20
	v[342] += v[343]*/
	reg1 += skill_ID > 1 ? 0 : 1
	//@comment "#If Pointed Type, Ck range"
	//v[342] += 2
	@if skill_Type == Type_PointSkl {
	    //v[344] = v[342] + 9
	    //v[352] = v[341] + 4707
	    //v[351] = v[344] - 2
	    //camera difference
	    v[351] = 51
	    v[v[351]].copy v[353], 2
	    v[353] .sub agent_RelativeX, 2
	    v[353] .mul v[353], 2
	    v[351] = v[353] + v[354]
	    v[352] = skill_Range_max //v[v[344]]
	    //if out of range 
	    @if v[351] > skill_Range_max {
		reg1 += 1
		//call ranged indicator
		@call .cev 81
		
	    }
	    
	}.elif skill_Type == Type_TargetSkl {//@comment "#If Target Type, Ck range and ID"
	    //v[344] = v[342] + 9
	    //v[352] = v[341] + 4707
	    //v[351] = v[341] + 4718
	    //@comment "If target exists"
	    @if agent_TargetAgentID >= 1 {
		v[353] = agent_TargetAgentID * 300 
		v[353] += 4707
		v[v[353]].copy v[353], 2
		v[353] .sub agent_RelativeX, 2
		v[353] .mul v[353], 2
		v[351] = v[353] + v[354]
		v[352] = skill_Range_max
	        //if out of range 
		@if v[351] > skill_Range_max {
		    reg1 += 1
		    //call ranged indicator
		    @call .cev 81
		    
		}
		
	    } .else bl {
		reg1 += 1
		
	    }
	    
	}

	//@comment "#Check usage"
	//v[342] += 1

	//@comment "If DamageSkill"
	@if skill_Usage == Usage_Damage {
	    //@comment "You cannot use damage skill with shieldwall/pikewall/Scout" 9.3.23 you should check what is going on with Scout tactics flag.
	    reg1 += agent_TacticsOrderFlag & 135 ? 1 : 0
	    
	}

	//@comment "#Check CD"
	//v[342] = v[341] + 4794 
	//v[342] += $skillno
	v[342] = 694 + $skillno
	reg1 += v[v[342]] <= 0 ? 0 : 1


	//@comment "#Check Cost"
	//v[342] = v[341] + 4827 
	//v[342] += ($skillno * 20)
	//v[344] = v[341] + 4808
	reg1 += skill_Cost <= agent_SP ? 0 : 1

	//@comment "#Check Casting Motion"
	reg1 += agent_ActionState < 4 ? 0 : 1

	//@comment "#Check silence"
	reg1 += agent_ProcessObjBit & 262144 ? 1 : 0
}



