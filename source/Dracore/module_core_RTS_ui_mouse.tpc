
// The UI system must be remade...

def {
	UI_BOTTOMLEFT = 0
	UI_TOPRIGHT = 1

}

def macro_extract_selecting_unit_param = {
	    Ptr1 = v[Adr_PlayerSelectList_Head] * 300
	    val_add(Ptr1,N4701) // Ptr1 += 4701
	    v[Ptr1].copy agent_ObjectType,300

}


def tempstrcat_colour = __str(":\c[\v[", __id(var1), "]]" )

__fn macro_strcat_adjustment $str1 $var $colour {
	t[3000].cat $str1
	var1 = $colour
	t[3000].cat tempstrcat_colour .extract // ":\c[\v[11]]" .extract
	t[3000].cat $var
}


// ACTUAL PROCESS STARTS HERE
__fn UI_CEV_MOUSE_OBSERVER {
	@if LEGS_Player_can_control .isOn() {

			@if s[5] .isOff() {
				LEGS_Showing_PopupWindow_1.off

				// "Escape"
				@if s[181] .isOn() {
						LEGV_sentence_id_on_popup1 = 10001
						LEGS_Showing_PopupWindow_1.on
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
					LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1

					// "#call quickstrings"
					//var1 = 50
					//@call .cev 1890
					getQstr(50)
					@pic[PicID_Popup_1].strpic {
							t[3000]
							.pos LEGV_MousePointer_X, LEGV_MousePointer_Y .topRight
							.size 0, 0                    .chromakey 1
							.scale 100
							.trans v[1066]
							.rgbs 100, 100, 100, 100
							.font Font_UI, v[4511]
							.spacing 0, 0
							.skin "" .stretch
							.mapLayer 9
							.eraseWhenTransfer
							.affectedByFlash
							.affectedByShake
					}
					
						}
						s[201].on
						
				}

				// "FF"
				@if s[185] .isOn() {
						LEGV_sentence_id_on_popup1 = 10002
						LEGS_Showing_PopupWindow_1.on
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
					LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
					// "#call quickstrings"
					var1 = 184
					@call .cev 1890
					t[501] .asg "\c[8]\t[3001]\c[0]
			\t[3002]
			\t[3003]" .extract
					@pic[PicID_Popup_1].strpic {
							t[501]
							.pos LEGV_MousePointer_X, LEGV_MousePointer_Y .topRight
							.size 0, 0                    .chromakey 1
							.scale 100
							.trans v[1066]
							.rgbs 100, 100, 100, 100
							.font Font_UI, v[4511]
							.spacing 0, 0
							.skin "" .stretch
							.mapLayer 9
							.eraseWhenTransfer
							.affectedByFlash
							.affectedByShake
					}
					
						}
						s[201].on
						
				}

				// "Pause"
				@if s[184] .isOn() {
						LEGV_sentence_id_on_popup1 = 10003
						LEGS_Showing_PopupWindow_1.on
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
					LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
					// "#call quickstrings"
					var1 = 183
					@call .cev 1890
					t[501] .asg "\c[8]\t[3001]\c[0]
			\t[3002]
			\t[3003]" .extract
					@pic[PicID_Popup_1].strpic {
							t[501]
							.pos LEGV_MousePointer_X, LEGV_MousePointer_Y .topRight
							.size 0, 0                    .chromakey 1
							.scale 100
							.trans v[1066]
							.rgbs 100, 100, 100, 100
							.font Font_UI, v[4511]
							.spacing 0, 0
							.skin "" .stretch
							.mapLayer 9
							.eraseWhenTransfer
							.affectedByFlash
							.affectedByShake
					}
					
						}
						s[201].on
						
				}

				// "IdleWorker"
				@if s[188] .isOn() {
						LEGV_sentence_id_on_popup1 = 10004
						LEGS_Showing_PopupWindow_1.on
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
					LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
					// "#call quickstrings"
					var1 = 425 + s[187]
					//@call .cev 1890
					getQstr(var1)
					@pic[PicID_Popup_1].strpic {
							t[3000]
							.pos LEGV_MousePointer_X, v[1286] .bottomRight
							.size 0, 0                    .chromakey 1
							.scale 100
							.trans v[1066]
							.rgbs 100, 100, 100, 100
							.font Font_UI, v[4511]
							.spacing 0, 0
							.skin "" .stretch
							.mapLayer 9
							.eraseWhenTransfer
							.affectedByFlash
							.affectedByShake
					}
					
						}
						s[201].on
						
				}

				// "Log"
				@if s[186] .isOn() {
						LEGV_sentence_id_on_popup1 = 10005
						LEGS_Showing_PopupWindow_1.on
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
					LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1

					// "#call quickstrings"
					// var1 = 427
					// @call .cev 1890
					getQstr(427)
					@pic[PicID_Popup_1].strpic {
							t[3000]
							.pos LEGV_MousePointer_X, v[1286] .bottomRight
							.size 0, 0                    .chromakey 1
							.scale 100
							.trans v[1066]
							.rgbs 100, 100, 100, 100
							.font Font_UI, v[4511]
							.spacing 0, 0
							.skin "" .stretch
							.mapLayer 9
							.eraseWhenTransfer
							.affectedByFlash
							.affectedByShake
					}
					
						}
						s[201].on
						
				}

				// "Cent Monitor"
				@if v[81] == 1 {
						// "Unit name"
						@pic[974].getInfo .cewh .currentRect v[1952], v[1953], v[1954], v[1955]
						@if `between(LEGV_MousePointer_X, v[1952] - 190, v[1952] - 82) && between(LEGV_MousePointer_Y, v[1953] + 2, v[1953] + 18) {
					LEGV_sentence_id_on_popup1 = 10000
					LEGS_Showing_PopupWindow_1.on
					@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
							LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
							TT1 = v[1115]
							TT2 = v[1286]

							//var1 = 185
							//@call .cev 1890
							getQstr(185)
							@pic[PicID_Popup_1].strpic {
						t[3000]
						.pos TT1, TT2 .bottom
						.size 0, 0                        .chromakey 1
						.scale 100
						.trans v[1066]
						.rgbs 100, 100, 100, 100
						.font Font_UI, v[4511]
						.spacing 0, 0
						.skin "" .stretch
						.mapLayer 9
						.eraseWhenTransfer
						.affectedByFlash
						.affectedByShake
							}
							
					}
					s[201].on
					
						}
						@if `between(LEGV_MousePointer_Y, v[1953] + v[1955] / 4, v[1953] + v[1955] / 4 + 8) {
					TT1 = 0
					@if `between(LEGV_MousePointer_X - 74 * TT1, v[1952] - 188, v[1952] - 114) {
							LEGV_sentence_id_on_popup1 = 10006 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						var1 = 462 + TT1
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20475],v[872],2)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
							}
							s[201].on
							
					}

					// HP
					TT1 = 1
					@if `between(LEGV_MousePointer_X - 74 * TT1, v[1952] - 188, v[1952] - 114) {
							LEGV_sentence_id_on_popup1 = 10006 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 462 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20476],v[863],3)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}

					// SP
					TT1 = 2
					@if `between(LEGV_MousePointer_X - 74 * TT1, v[1952] - 188, v[1952] - 114) {
							LEGV_sentence_id_on_popup1 = 10006 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 462 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20475],v[873],10)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}
					
						}
						@if `between(LEGV_MousePointer_Y, v[1953] + v[1955] / 4 + 8, v[1953] + v[1955] / 4 + 18) {
					// AD
					TT1 = 0
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 456 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20476],v[861],17)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}

					// AP
					TT1 = 1
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 456 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20476],v[862],16)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}
					// MR
					TT1 = 2
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 456 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20476],v[864],6)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}
					// HIT
					TT1 = 3
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
								LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
								var1 = 456 + TT1
								TT1 = v[1115]
								TT2 = v[1286]
								macro_extract_selecting_unit_param
								@call .cev 1890
								macro_strcat_adjustment(t[20476],v[865],5)
								@pic[PicID_Popup_1].strpic {
										t[3000]
										.pos TT1, TT2 .bottom
										.size 0, 0                            .chromakey 1
										.scale 100
										.trans v[1066]
										.rgbs 100, 100, 100, 100
										.font Font_UI, v[4511]
										.spacing 0, 0
										.skin "" .stretch
										.mapLayer 9
										.eraseWhenTransfer
										.affectedByFlash
										.affectedByShake
								}
								
							}
							s[201].on
							
					}


					// EVA
					TT1 = 4
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 456 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						@call .cev 1890
						macro_extract_selecting_unit_param
						macro_strcat_adjustment(t[20476],v[866],3)

						// addtionally, show ranged EVA as well
						t[3000].cat LF
						get_base_rangedEVA(agent_ProcessEVA,agent_PerkFlagBits1,agent_ProcessMS)
						reg1 += (agent_TacticsOrderFlag & 6 ? agent_ShieldRangedProtection >> 1 : 0) + agent_ShieldRangedProtection

						macro_strcat_adjustment(t[20492],reg1,3)

						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}
					TT1 = 5
					@if `between(LEGV_MousePointer_X - 36 * TT1, v[1952] - 192, v[1952] - 148) {
							LEGV_sentence_id_on_popup1 = 10001 + TT1
							LEGS_Showing_PopupWindow_1.on
							@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
						LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
						var1 = 456 + TT1
						TT1 = v[1115]
						TT2 = v[1286]
						macro_extract_selecting_unit_param
						@call .cev 1890
						macro_strcat_adjustment(t[20476],v[875],0)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos TT1, TT2 .bottom
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						
							}
							s[201].on
							
					}
					
						}
						
				}

				def IconSize = 15

				// Unit State Icons
				@if `between(LEGV_MousePointer_Y, LEGV_ConstBuffIconsStartY - 16, LEGV_ConstBuffIconsStartY) {
					
					// "Terrain"
					@if `between(LEGV_MousePointer_X, LEGV_ConstBuffIconsStartX - 4 * LEGV_ConstBuffIconsDif, LEGV_ConstBuffIconsStartX - (4 * LEGV_ConstBuffIconsDif) + IconSize) {
							@if LEGS_selecting_enemy .isOn() {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
						
							} .else bl {
						@if v[101] >= 1 {
								LEGS_Showing_PopupWindow_1.on
								Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
								
						}
						
							}


							// get what terrain effect is on the agent
							Ptr20 *= 300
							Ptr20 += 4703
							// "#NOT SMART"
							@if `v[Ptr20] & 8 {
						var1 = 448
						
							} .else bl {
						@if `v[Ptr20] & 2 {
								var1 = 447
								
						} .else bl {
								@if `v[Ptr20] & 1 {
							var1 = 446
							
								} .else bl {
							var1 = -1
							
								}
								
						}
						
							}
							@if var1 != -1 {
						LEGV_sentence_id_on_popup1 = var1
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
								LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1

								TT1 = LEGV_MousePointer_X
								TT2 = v[1286] - 16
								show_pupwin1_with_Qstr(var1,TT1,TT2)
								
						}
						
							}
							s[201].on
							
					}

					// "Tactical Order"
					@if `between(LEGV_MousePointer_X, LEGV_ConstBuffIconsStartX - 3 * LEGV_ConstBuffIconsDif, LEGV_ConstBuffIconsStartX + IconSize + -(3 * LEGV_ConstBuffIconsDif))  {
							@if LEGS_selecting_enemy .isOn() {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
						
							} .else bl {
						@if v[101] >= 1 {
								LEGS_Showing_PopupWindow_1.on
								Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
								
						}
						
							}
				
							Ptr20 *= 300
							Ptr20 += 4948
							@if v[Ptr20] != 0 {
						LEGV_sentence_id_on_popup1 = 1211 + v[Ptr20]
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
								LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
								TT1 = LEGV_MousePointer_X
								TT2 = v[1286] - 16
								// "#call quickstrings"
								// "#NOT SMART"
								@if v[Ptr20] <= 8 {
							var1 = 5 + [1, 2, 3, 4, 4][(v[Ptr20] / 2)]
							
								} .else bl {
							@if v[Ptr20] == 16 {
									var1 = 182
									
							} .else bl {
									@if v[Ptr20] == 64 {
								var1 = 467
								
									} .else bl {
								
									}
									
							}
							
								}
								show_pupwin1_with_Qstr(var1,TT1,TT2)
								
						}
						s[201].on
						
							}
							
					}

					// "Morale"
					@if `between(LEGV_MousePointer_X, LEGV_ConstBuffIconsStartX - 2 * LEGV_ConstBuffIconsDif, LEGV_ConstBuffIconsStartX + IconSize + -(2 * LEGV_ConstBuffIconsDif)) {
							@if LEGS_selecting_enemy .isOn() {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
						
							} .else bl {
						@if v[101] >= 1 {
								LEGS_Showing_PopupWindow_1.on
								Ptr20 = LEGS_selecting_enemy == 0 ? v[101] : v[100]
								
						}
						
							}
							Ptr20 *= 300
							Ptr20 += 4960
							@if v[Ptr20] != 0 {
						LEGV_sentence_id_on_popup1 = 1189 + v[Ptr20]
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
								LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
								TT1 = LEGV_MousePointer_X
								TT2 = v[1286] - 16
								@if v[Ptr20] > 0 {
							var1 = 1 + v[Ptr20]
							@call .cev 1890
							@pic[PicID_Popup_1].strpic {
									"\c[5]\t[3001]\c[0]：
			\t[3002]
			\c[5]\t[3003] \t[3004]"
									.pos TT1, TT2 .bottomLeft
									.size 0, 0                            .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							
								} .else bl {
							var1 = 5
							@call .cev 1890
							@pic[PicID_Popup_1].strpic {
									"\c[2]\t[3001]\c[0]：
			\t[3002]
			\c[1]\t[3003]"
									.pos TT1, TT2 .bottomLeft
									.size 0, 0                            .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							
								}
								
						}
						s[201].on
						
							}
							
					}

					// "Melee Penalty"
					@if `between(LEGV_MousePointer_X, LEGV_ConstBuffIconsStartX - 1 * LEGV_ConstBuffIconsDif, LEGV_ConstBuffIconsStartX + IconSize + -(1 * LEGV_ConstBuffIconsDif)) {
							LEGS_Showing_PopupWindow_1.on
							Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4781
							@if v[Ptr20] >= 1 {
						LEGV_sentence_id_on_popup1 = 1198
						@if LEGV_sentence_id_on_popup1 != LEGV_Watchdog_on_popupwindow1 {
								LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
								TT1 = LEGV_MousePointer_X
								TT2 = v[1286] - 16
								show_pupwin1_with_Qstr(1,TT1,TT2)
						}
						s[201].on
						
							}
							
					}

					// "Buffs"
					@loop 8 .dst v[360] {
							@if `between(LEGV_MousePointer_X, LEGV_ConstBuffIconsStartX + v[360] * LEGV_ConstBuffIconsDif, LEGV_ConstBuffIconsStartX + IconSize + v[360] * LEGV_ConstBuffIconsDif) {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 71 + v[360]
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						@if v[99] <= 1 {
								@call .cev 1101
								
						}
						@break
						
							}
							
					
					
					}
				}


				// "Passive"
				@if `between(LEGV_MousePointer_X, v[1287], v[1287] + v[1289]) && between(LEGV_MousePointer_Y, v[1288], v[1288] + v[1290]) {
						TT1 = v[1287] + v[1289] / 2 + 1
						TT2 = v[1288] + v[1290] / 2
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
							v[1289].copy v[343], 2
							show_frame_overlap_effect(TT1,TT2,TT3,TT4)
							/*
							@pic[PicID_ButtonSelect].strpic {
									""
									.pos TT1, TT2 .center
									.size v[343], v[344]                    .chromakey 1
									.scale 100
									.trans 20
									.rgbs 0, 200, 0, 100
									.font Font_UI, v[4511]
									.spacing 0, 4
									.skin "Odinscall_mapcam" .nobg .noGradation
									.add
									.mapLayer 9
									.eraseWhenTransfer
							}
							*/

							@pic[PicID_Popup_1].erase
							@pic[PicID_Auxilia_Message_Window].erase
							@pic[PicID_Square_Checker].erase
							s[82].off
							
						}
						LEGS_Showing_PopupWindow_1.on
						v[299] = LEGS_selecting_enemy == 0 ? v[101] : v[100]
						Ptr20 = v[299] * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 221
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						@if LEGS_selecting_enemy .isOn() {
							@call .cev 1100

						} .else bl {
					@if v[101] >= 1 {
							@if v[99] > 1 {
								LEGV_sentence_id_on_popup1 = s[24] == 1 ? LEGV_sentence_id_on_popup1 : -2
								
							}
							@call .cev 1100
							
					}
					
						}
						
				}
				// "Q"
				@if `between(LEGV_MousePointer_X, v[1037] - v[1291], v[1037] + v[1291]) && between(LEGV_MousePointer_Y, v[1038] - v[1292], v[1038] + v[1292]) {
						TT1 = v[1037]
						TT2 = v[1038] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}
						@if LEGS_selecting_enemy .isOn() {
					LEGS_Showing_PopupWindow_1.on
					Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
					// "スキルチェック"
					v[301] = Ptr20 + 141
					// "番号を見る"
					LEGV_sentence_id_on_popup1 = v[v[301]]
					// "skillが存在するなら文章を見る"
					@if LEGV_sentence_id_on_popup1 >= 1 {
							@call .cev 1200
							
					}
					
						} .else bl {
					@if v[101] >= 1 {
							@if s[27] .isOn() {
						// "STATICを選択中"
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = v[101] * 300 + 4700
						// "生産できるやつを見る"
						v[301] = Ptr20 + 138
						// "Qなので1"
						TT1 = 1
						// "番号を見る"
						v[301] += TT1 * 3
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 199
								
						}
						
							} .else bl {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 141
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "skillが存在するなら文章を見る"
						v[89] = v[557]
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 1200
								
						}
						
							}
							
					}
					
						}
						
				}
				// "W"
				@if `between(LEGV_MousePointer_X, v[1039] - v[1291], v[1039] + v[1291]) && between(LEGV_MousePointer_Y, v[1040] - v[1292], v[1040] + v[1292]) {
						TT1 = v[1039]
						TT2 = v[1040] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}
						@if LEGS_selecting_enemy .isOn() {
					LEGS_Showing_PopupWindow_1.on
					Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
					// "スキルチェック"
					v[301] = Ptr20 + 161
					// "番号を見る"
					LEGV_sentence_id_on_popup1 = v[v[301]]
					// "生産できる兵士が存在するなら文章を見る"
					@if LEGV_sentence_id_on_popup1 >= 1 {
							@call .cev 1200
							
					}
					
						} .else bl {
					@if v[101] >= 1 {
							@if s[27] .isOn() {
						// "STATICを選択中"
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = v[101] * 300 + 4700
						// "生産できるやつを見る"
						v[301] = Ptr20 + 138
						// "W 2"
						TT1 = 2
						// "番号を見る"
						v[301] += TT1 * 3
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 199
								
						}
						
							} .else bl {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 161
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						v[89] = v[558]
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 1200
								
						}
						
							}
							
					}
					
						}
						
				}
				// "E"
				@if `between(LEGV_MousePointer_X, v[1041] - v[1291], v[1041] + v[1291]) && between(LEGV_MousePointer_Y, v[1042] - v[1292], v[1042] + v[1292]) {
						TT1 = v[1041]
						TT2 = v[1042] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}
						@if LEGS_selecting_enemy .isOn() {
					LEGS_Showing_PopupWindow_1.on
					Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
					// "スキルチェック"
					v[301] = Ptr20 + 181
					// "番号を見る"
					LEGV_sentence_id_on_popup1 = v[v[301]]
					// "生産できる兵士が存在するなら文章を見る"
					@if LEGV_sentence_id_on_popup1 >= 1 {
							@call .cev 1200
							
					}
					
						} .else bl {
					@if v[101] >= 1 {
							@if s[27] .isOn() {
						// "STATICを選択中"
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = v[101] * 300
						Ptr20 += 4700
						// "生産できるやつを見る"
						v[301] = Ptr20 + 138
						// "E 3"
						TT1 = 3
						// "番号を見る"
						v[301] += TT1 * 3
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 199
								
						}
						
							} .else bl {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 181
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						v[89] = v[559]
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 1200
								
						}
						
							}
							
					}
					
						}
						
				}
				// "R"
				@if `between(LEGV_MousePointer_X, v[1043] - v[1291], v[1043] + v[1291]) && between(LEGV_MousePointer_Y, v[1044] - v[1292], v[1044] + v[1292]) {
						TT1 = v[1043]
						TT2 = v[1044] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}
						@if LEGS_selecting_enemy .isOn() {
					LEGS_Showing_PopupWindow_1.on
					Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
					// "スキルチェック"
					v[301] = Ptr20 + 201
					// "番号を見る"
					LEGV_sentence_id_on_popup1 = v[v[301]]
					// "生産できる兵士が存在するなら文章を見る"
					@if LEGV_sentence_id_on_popup1 >= 1 {
							@call .cev 1200
							
					}
					
						} .else bl {
					@if v[101] >= 1 {
							@if s[27] .isOn() {
						// "STATICを選択中"
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = v[101] * 300 + 4700
						// "生産できるやつを見る"
						v[301] = Ptr20 + 138
						// "E 3"
						TT1 = 4
						// "番号を見る"
						v[301] += TT1 * 3
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						v[89] = v[560]
						@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 199
								
						}
						
							} .else bl {
						LEGS_Showing_PopupWindow_1.on
						Ptr20 = (LEGS_selecting_enemy == 0 ? v[101] : v[100]) * 300 + 4700
						// "スキルチェック"
						v[301] = Ptr20 + 201
						// "番号を見る"
						LEGV_sentence_id_on_popup1 = v[v[301]]
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								v[89] = v[560]
								@call .cev 1200
								
						}
						
							}
							
					}
					
						}
						
				}
				// "A"
				TT1 = between(LEGV_MousePointer_X, v[1045] - v[1291], v[1045] + v[1291]) && between(LEGV_MousePointer_Y, v[1046] - v[1292], v[1046] + v[1292]) ? 1 : 0
				@if TT1 == 1 {
						TT1 = v[1045]
						TT2 = v[1046] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}
						@if v[101] >= 1 {
					LEGS_Showing_PopupWindow_1.on
					@if s[27] .isOff() {
							@if s[29] .isOn() {
						LEGS_Showing_PopupWindow_1.on
						LEGV_sentence_id_on_popup1 = 17
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								v[89] = v[484]
								@call .cev 1200
								
						}
						
							} .else bl {

						// "STATIC以外"
						@if v[943] >= 1 {
								
						} .else bl {
								// "警戒指令"
								LEGV_sentence_id_on_popup1 = -1
								@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
							// "#call quickstrings"
							// var1 = 106
							// @call .cev 1890
							getQstr(106)
							@pic[PicID_Popup_1].strpic {
									t[3000]
									.pos v[1301], v[1065] .bottomLeft
									.size 0, 0                                    .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							@pic[PicID_Auxilia_Message_Window].erase
							
								}
								
						}
						
							}
							
					} .else bl {
							// "STATICを選択中"
							LEGS_Showing_PopupWindow_1.on
							Ptr20 = v[101] * 300 + 4700
							// "生産できるやつを見る"
							v[301] = Ptr20 + 138
							// "A 5"
							TT1 = 5
							// "番号を見る"
							v[301] += TT1 * 3
							LEGV_sentence_id_on_popup1 = v[v[301]]
							// "生産できる兵士が存在するなら文章を見る"
							@if LEGV_sentence_id_on_popup1 >= 1 {
						@call .cev 199
						
							}
							
					}
					
						}
						
				}

				// "S"
				@if `between(LEGV_MousePointer_X, v[1047] - v[1291], v[1047] + v[1291]) && between(LEGV_MousePointer_Y, v[1048] - v[1292], v[1048] + v[1292]) {
						TT1 = v[1047]
						TT2 = v[1048] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}

						@if v[101] >= 1 {
					LEGS_Showing_PopupWindow_1.on
					@if s[27] .isOff() {
							@if s[29] .isOn() {
						LEGS_Showing_PopupWindow_1.on
						LEGV_sentence_id_on_popup1 = 17
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								v[89] = v[485]
								@call .cev 1200
								
						}
						
							} .else bl {
						// "STATIC以外"
						@if v[943] >= 1 {
								
						} .else bl {
								// "防御指令"
								LEGV_sentence_id_on_popup1 = -2
								@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
							// var1 = 107
							// @call .cev 1890
							getQstr(107)
							@pic[PicID_Popup_1].strpic {
									t[3000]
									.pos v[1301], v[1065] .bottomLeft
									.size 0, 0                                    .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							@pic[PicID_Auxilia_Message_Window].erase
							
								}
								
						}
						
							}
							
					} .else bl {
							// "STATICを選択中"
							LEGS_Showing_PopupWindow_1.on
							Ptr20 = v[101] * 300 + 4700
							// "生産できるやつを見る"
							v[301] = Ptr20 + 138
							// "S 6"
							TT1 = 6
							// "番号を見る"
							v[301] += TT1 * 3
							LEGV_sentence_id_on_popup1 = v[v[301]]
							// "生産できる兵士が存在するなら文章を見る"
							@if LEGV_sentence_id_on_popup1 >= 1 {
						@call .cev 199
						
							}
							
					}
					
						}
						
				}

				// "D"
				@if `between(LEGV_MousePointer_X, v[1049] - v[1291], v[1049] + v[1291]) && between(LEGV_MousePointer_Y, v[1050] - v[1292], v[1050] + v[1292]) {
						TT1 = v[1049]
						TT2 = v[1050] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}

						@if v[101] >= 1 {
					LEGS_Showing_PopupWindow_1.on
					@if s[27] .isOff() {
							@if s[29] .isOn() {
						LEGS_Showing_PopupWindow_1.on
						LEGV_sentence_id_on_popup1 = 17
						// "生産できる兵士が存在するなら文章を見る"
						@if LEGV_sentence_id_on_popup1 >= 1 {
								v[89] = v[486]
								@call .cev 1200
								
						}
						
							} .else bl {
						// "STATIC以外"
						@if v[943] >= 1 {
								
						} .else bl {
								// "待機指令"
								LEGV_sentence_id_on_popup1 = -3
								@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
							var1 = 108
							@call .cev 1890

							@pic[PicID_Popup_1].strpic {
									"\t[3000]"
									.pos v[1301], v[1065] .bottomLeft
									.size 0, 0                                    .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							@pic[PicID_Auxilia_Message_Window].erase
							
								}
								
						}
						
							}
							
					} .else bl {
							// "STATICを選択中"
							LEGS_Showing_PopupWindow_1.on
							Ptr20 = v[101] * 300 + 4700
							// "生産できるやつを見る"
							v[301] = Ptr20 + 138
							// "D 7"
							TT1 = 7
							// "番号を見る"
							v[301] += TT1 * 3
							LEGV_sentence_id_on_popup1 = v[v[301]]
							// "生産できる兵士が存在するなら文章を見る"
							@if LEGV_sentence_id_on_popup1 >= 1 {
								@call .cev 199
						
							}
							
					}
					
						}
						
				}

				// "F"
				@if `between(LEGV_MousePointer_X, v[1051] - v[1291], v[1051] + v[1291]) && between(LEGV_MousePointer_Y, v[1052] - v[1292], v[1052] + v[1292]) {
						TT1 = v[1051]
						TT2 = v[1052] - 1
						@pic[PicID_ButtonSelect].getInfo .cewh .baseRect v[345], v[346], v[347], v[347]
						@if `TT1 != v[345] || TT2 != v[346] {
					v[1291].copy v[343], 2
					v[343..344] *= 2
					@pic[PicID_ButtonSelect].strpic {
							""
							.pos TT1, TT2 .center
							.size v[343], v[344]                    .chromakey 1
							.scale 100
							.trans 20
							.rgbs 0, 200, 0, 100
							.font "", 12 .noShadow
							.spacing 0, 4
							.skin "Odinscall_mapcam" .nobg .noGradation
							.add
							.mapLayer 9
							.eraseWhenTransfer
					}
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					@pic[PicID_Square_Checker].erase
					
						}

						@if v[101] >= 1 {
					LEGS_Showing_PopupWindow_1.on
					@if s[27] .isOff() {
							// "STATIC以外"
							@if s[29] .isOn() {
						
							} .else bl {
						@if v[943] >= 1 {
								LEGV_sentence_id_on_popup1 = -6
								@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
							// "#call quickstrings"
							// var1 = 104
							// @call .cev 1890
							show_pupwin1_with_Qstr(104,v[1301],v[1065])
							@pic[PicID_Auxilia_Message_Window].erase
							
								}
								
						} .else bl {
								// "手動指令"
								LEGV_sentence_id_on_popup1 = -4
								@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
							// var1 = 109
							// @call .cev 1890
							show_pupwin1_with_Qstr(109,v[1301],v[1065])
							@pic[PicID_Auxilia_Message_Window].erase
							
								}
								
						}
						
							}
							
					} .else bl {
							// "STATICを選択中"
							LEGV_sentence_id_on_popup1 = -5
							@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
						// "#call quickstrings"
						// var1 = 105
						// @call .cev 1890
						getQstr(105)
						@pic[PicID_Popup_1].strpic {
								t[3000]
								.pos v[1301], v[1065] .bottomLeft
								.size 0, 0                            .chromakey 1
								.scale 100
								.trans v[1066]
								.rgbs 100, 100, 100, 100
								.font Font_UI, v[4511]
								.spacing 0, 0
								.skin "" .stretch
								.mapLayer 9
								.eraseWhenTransfer
								.affectedByFlash
								.affectedByShake
						}
						@pic[PicID_Auxilia_Message_Window].erase
						
							}
							
					}
					
						}
						
				}


				// PAUSED INFORMATION
				// awful as fugg :D
				@if LEGS_Showing_PopupWindow_1 .isOff() {
						@if s[2] .isOn() {
					@if LEGV_MousePointer_Y <= v[1286] {
							@if `!(LEGV_MousePointer_X <= v[4514] && LEGV_MousePointer_Y >= v[4515]) {
						@if `!(between(LEGV_MousePointer_X, v[1282], v[1284]) && between(LEGV_MousePointer_Y, v[1283], v[1285])) {
								@if v[93] >= 12 {
							LEGS_Showing_PopupWindow_1.on
							@if s[61] .isOff() {
									v[368..369] = 0
									@loop v[1004] .dst v[301] {
								v[302] = v[301] * 300
								v[302] += 5001
								// "とりあえず40体までしか選択できない"
								// "ObjID>0"
								@if v[v[302]] > 0 {
										v[v[302]].copy v[601], 11
										// "左上"
										v[303] = v[607] - v[610]
										v[303] -= v[610] <= 18 ? v[1122] : 0
										v[304] = v[608] - v[611]
										v[304] -= v[611] <= 18 ? v[1123] : 0
										// "右下"
										v[305] = v[607] + v[610]
										v[305] += v[610] <= 18 ? v[1122] : 0
										v[306] = v[608] + v[611]
										v[306] += v[611] <= 18 ? v[1123] : 0
										v[310] = v[302] + 23
										v[311] = v[302] + 100
										v[320] = v[302] + 99
										@if `between(LEGV_MousePointer_X, v[303], v[305]) && between(LEGV_MousePointer_Y, v[304], v[306]) {
									v[311] = v[302] + 99
									v[v[311]].copy v[700], 150
									LEGV_sentence_id_on_popup1 = 1000

									def STRING_PAUSE_AGENT_MONITOR = __str("\c[\v[",__id(TT2),"]]\t[\v[",__id(TT1),"]]\c[0]",RAWSTR_LF,"\c[1]HP:\v[706]/\v[705]",RAWSTR_LF,"\c[3]AR:\v[711]/\v[738]",RAWSTR_LF,"\c[10]SP:\v[708]/\v[707]")
									@if LEGV_Watchdog_on_popupwindow1 != LEGV_sentence_id_on_popup1 {
											TT1 = v[301] + 1
											v[369] = TT1
											TT1 += v[4562]
											TT2 = [8, 2, 17][(v[700] + 1)]
											v[350] = v[v[302] + 6]
											v[351] = v[v[302] + 7] - 16
											t[501] .asg STRING_PAUSE_AGENT_MONITOR .extract
											@pic[PicID_Popup_1].strpic {
										t[501]
										.pos v[350], v[351] .bottom
										.size 0, 0                                                        .chromakey 1
										.scale 100
										.trans 100
										.rgbs 100, 100, 100, 100
										.font Font_UI, v[4511]
										.spacing 0, 0
										.skin "" .stretch
										.mapLayer 9
										.eraseWhenTransfer
										.affectedByFlash
										.affectedByShake
											}
											@pic[PicID_Popup_1].move {
										.pos v[350], v[351] .bottom
										.scale 100
										.trans v[1066]
										.time 1
										.rgbs 100, 100, 100, 100
											}
											
									}
									@break
									
										}
										
								}
								
									}
									
									s[61].on
									
							} .else bl {
									@if v[369] > 0 {
								v[368] -= 1
								// "#White Flash"
								v[302] = v[369] * 300 + 4701
								@if `v[v[302] + 294] == 0 && v[368] <= 0 {
										v[v[302] + 294] = 4
										v[0] = v[v[302] + 290..v[302] + 292] = [120, 120, 120]
										v[368] = 8
										
								}
								
									}
									
							}
							
								}
								
						}
						
							}
							
					}
					
						}

						@if LEGS_Showing_PopupWindow_1 .isOff() {
					s[61].off
					LEGV_sentence_id_on_popup1 = 0
					@pic[PicID_Popup_1].erase
					@pic[PicID_Auxilia_Message_Window].erase
					// "Paused Information"
					@if v[81] == 0 {
						@if s[11] .isOff() {
							@if Control_ClickableAgentHolder <= 0 {
								// ????
								// "#Check Terrain"
									LEGV_MousePointer_X.copy var1, 2
									val_sub(var2,N8) // v[12] -= 8

									// @call .cev 2000
									macro_convert_relativeXY_into_maptileXY(var1,var2,reg1,reg2)

									// "######################Get Terrain and Elevation info"
									v[313] = v[v[1182] + v[21] - v[69] + (v[22] - v[70]) * v[2061]]
									TT1 = v[313] / 100000000
									TT2 = v[313] % 100
									v[350] = LEGV_MousePointer_X
									v[351] = LEGV_MousePointer_Y - 16
									TT2 = v[1239] + TT2
									// "######################"
									reg1.copy TT1,2
									// @call .cev 2001 // 
									macro_convert_maptileXY_into_relativeXY(TT1,TT2,reg2,reg3)
									v[344] = 63
									@if Var_MouseMode != MODE_Elevation {
										@pic[PicID_pointer_sub].show {
												"ui\terrainsquare"
												.pos reg2, reg3 .center
												.chromakey 1
												.scale 100
												.trans v[344]
												.rgbs 100, 100, 100, 100
												.add
												.mapLayer 5
												.eraseWhenTransfer
												.affectedByFlash
												.affectedByShake
										}
									}
							}
						} .else bl {
						@pic[PicID_pointer_sub].erase
						
							}
							
					} .else bl {
							@pic[PicID_pointer_sub].erase
							
					}
					@pic[PicID_ButtonSelect].erase
					
						} .else bl {
					@pic[PicID_pointer_sub].erase
					
						}
						
				}
				@wait 0
				// check clickable units if there's no popup
				@if LEGV_sentence_id_on_popup1 <= 0 {

					// always true
					reg10 = 1
					check_clickable_units({},CC_FLAG_ck_static_as_well)

					// this was fucking meaningless for now. noticed after writing up. reeee
					/* 
					@if between(LEGV_State_of_Central_Monitor,CENTMODE_ALLY_SINGLE,CENTMODE_ALLY_MULTI) {
						@if Is_Selecting_Civilian.isOn() {
							check_clickable_units({reg10 = agent_TeamID != 0 || agent_UnitType == UNIT_CLASS_SIEGE || agent_AgentType == UNIT_CLASS_STATIC ? 1 : 0},CC_FLAG_ck_static_as_well)

						}.else bl{
							check_clickable_units({reg10 = agent_TeamID != 0 ? 1 : 0},CC_FLAG_ck_static_as_well)

						}
					}.else bl{
						check_clickable_units({reg10 =  1},CC_FLAG_ck_static_as_well)

					} 
					*/
				}

				@if s[314] .isOn() {
					@wait 0
				}
				@if v[189] >= v[1128] {
					@wait 0
				}

				LEGV_Watchdog_on_popupwindow1 = LEGV_sentence_id_on_popup1
				v[90] = LEGV_sentence_id_on_popup1 <= 0 ? 0 : v[89]
				
			}
			
	}
}


__fn UI_CEV_MOUSE_UNIT_DESCRIPTION_WINDOW {
	// If Alt is held down, show Lore as well.

	// v[85] = GETKEY_Alt_PRESS == 1 ? 0 : v[85] // force refresh
	@if save_descID_1fpast != current_descriptionID {
			s[151].on
			v[31..34] = 0
			@if current_descriptionID <= 80 {
					v[257] = 200 + current_descriptionID
					@call .cev v[257]
					
			} .else bl {
					@if current_descriptionID >= 10000 {
							v[255] = v[101]
							v[257] = current_descriptionID - 9800
							@call .cev v[257]
							
					} .else bl {
							s[152].on
							v[254] = current_descriptionID
							@call .cev 300
							
					}
					
			}
			s[151].off
			s[201].off
			@if `between(current_descriptionID, 160, 166) {
					@call .cev 792
					
			} .else bl {
					@if current_descriptionID >= 10201 {
							@comment "Gate"
							@if `between(current_descriptionID, 11089, 11090) {
									@if current_descriptionID == 11089 {
											@pic[PicID_Popup_1].strpic {
													t[20318]
													.pos v[1301], v[1065] .bottomLeft
													.size 0, 0                        .chromakey 1
													.scale 100
													.trans v[1066]
													.rgbs 100, 100, 100, 100
													.font Font_UI, v[4511]
													.spacing 0, 0
													.skin "" .stretch
													.mapLayer 9
													.eraseWhenTransfer
													.affectedByFlash
													.affectedByShake
											}
											
									} .else bl {
											@pic[PicID_Popup_1].strpic {
													t[20319]
													.pos v[1301], v[1065] .bottomLeft
													.size 0, 0                        .chromakey 1
													.scale 100
													.trans v[1066]
													.rgbs 100, 100, 100, 100
													.font Font_UI, v[4511]
													.spacing 0, 0
													.skin "" .stretch
													.mapLayer 9
													.eraseWhenTransfer
													.affectedByFlash
													.affectedByShake
											}
											
									}
									
							} .else bl {
									s[202].off
									s[203].off
									@if s[1] .isOff() {
											@if current_descriptionID == 10201 {
													@if s[491] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10202 {
													@if s[492] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10203 {
													@if s[493] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10204 {
													@if s[494] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													@if v[31] >= 99999999 {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10205 {
													s[201].on
													
											}
											@if current_descriptionID == 10206 {
													s[201].on
													
											}
											@if current_descriptionID == 10207 {
													@if s[497] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10208 {
													@if s[498] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10209 {
													@if s[499] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10211 {
													@if s[441] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10212 {
													@if s[442] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10213 {
													@if s[443] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10214 {
													@if s[444] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10215 {
													@if s[445] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10216 {
													@if s[446] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10217 {
													@if s[447] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID == 10218 {
													@if s[448] .isOff() {
															
													} .else bl {
															s[202].on
															
													}
													s[201].on
													
											}
											@if current_descriptionID >= 10200 {
													s[201].on
													@if v[40] <= -3 {
															s[203].on
															
													}
													@if v[13] <= 0 {
															s[203].on
															
													}
													@if v[31] >= 99999999 {
															s[202].on
															
													}
													
											}
											
									}

									@comment "###############"
									@comment "Init"
									t[3000..3300] .asg ""
									@comment "Load"
									v[1961] = v[4520] + current_descriptionID
									v[1961] -= 10201
									t[2999] .asg t[v[1961]] .extract

									// {id}|{name}|{first_main}|{first_lore}|{after}|{after_lore}
									t[2999] .split "|", t[3001], v[1961]

									// first_main
									t[3002] .split "^", t[3201], v[1961]
									t[3002] .asg ""
									@comment "###############"
									@loop v[1961] .dst v[1962] {
											v[1963] = v[1211] + v[1962]
											v[1963] += 200
											t[3002] .cat t[v[1963]] .extract
											t[3002] .cat LF
											
									}


									// setup main lore
									t[505].asg "" // init
										@if t[3003].neq "" {
											t[3003] .split "^", t[3201], v[1961]
												t[3003] .asg ""
												@loop v[1961] .dst v[1962] {
													v[1963] = v[1211] + v[1962]
														v[1963] += 200
														t[3003] .cat t[v[1963]] .extract
														t[3003] .cat LF

												}
											t[505] .asg t[3003]
										}
							

									@comment "###############"
									t[3004] .split "^", t[3201], v[1961]
									@if t[3004] .eq "" {
											t[3004] .asg t[3002] // same as
											
									} .else bl {
											// there's additional lore text after researched
											t[3004] .asg ""
											@comment "###############"
											@loop v[1961] .dst v[1962] {
													v[1963] = v[1211] + v[1962]
													v[1963] += 200
													t[3004] .cat t[v[1963]] .extract
													t[3004] .cat LF
													
											}

											// check if there's new lore 
											@if t[3005] .neq "" {
												t[3005].asg .rep(t[3005], "^", LF)
												t[506] .asg t[3005] // prepare for it

											}
											
									}


									@comment "###############"
									@comment "Tech:"
									t[501] .asg t[20112]
									t[501] .cat t[3001]
									@if s[202] .isOff() {
											@comment "#"
											@comment "Costs:"
											t[502] .asg t[20113]
											@if v[31] >= 1 {
													t[502] .cat "\c[5]"
													t[502] .cat t[20114]
													t[502] .cat "\v[31]" .extract
													t[502] .cat " " .extract
													
											}
											@if v[32] >= 1 {
													t[502] .cat "\c[1]"
													t[502] .cat t[20115]
													t[502] .cat "\v[32]" .extract
													t[502] .cat " " .extract
													
											}
											@if v[33] >= 1 {
													t[502] .cat "\c[3]"
													t[502] .cat t[20116]
													t[502] .cat "\v[33]" .extract
													t[502] .cat " " .extract
													
											}
											@if v[34] >= 1 {
													t[502] .cat "\c[8]"
													t[502] .cat t[20117]
													t[502] .cat "\v[34]" .extract
													t[502] .cat " " .extract
													
											}
											t[502] .cat "\c[0]"
											@comment "#LF"
											t[503] .asg t[3002]
											v[35] = 0
											t[501] .cat LF
											t[501] .cat t[502]
											t[501] .cat LF
											// set normal description
											t[501] .cat "..."
											t[501] .cat t[503] .extract

											// If Alt is held down, show Lore as well.
											@if t[505].neq "" {
												t[501] .cat "\c[3]*"
												@if GETKEY_Alt == 1 {
													t[501] .cat "-------"
													t[501] .cat LF
													t[501] .cat t[505]
												}
											}

											@pic[PicID_Popup_1].strpic {
													t[501]
													.pos v[1301], v[1065] .bottomLeft
													.size 0, 0                        .chromakey 1
													.scale 100
													.trans v[1066]
													.rgbs 100, 100, 100, 100
													.font Font_UI, v[4511]
													.spacing 0, 0
													.skin "" .stretch
													.mapLayer 9
													.eraseWhenTransfer
													.affectedByFlash
													.affectedByShake
											}
											
									} .else bl {
											@if s[203] .isOff() {
													t[502] .asg t[20118] .extract
													
											} .else bl {
													t[502] .asg t[20430] .extract
													t[3004] .asg t[3002]
													
											}
											@comment "#LF"
											t[503] .asg t[3004]
											t[501] .cat LF
											t[501] .cat "\c[5]"
											t[501] .cat t[502]
											t[501] .cat "\c[0]"
											t[501] .cat LF
											t[501] .cat "..."
											t[501] .cat t[503] .extract

											// If Alt is held down, show Lore as well.
											@if t[506].neq "" {
												t[501] .cat "\c[3]*"
												@if GETKEY_Alt == 1 {
													t[501] .cat "-------"
													t[501] .cat LF
													t[501] .cat t[506]
												}
											}

											@pic[PicID_Popup_1].strpic {
													t[501]
													.pos v[1301], v[1065] .bottomLeft
													.size 0, 0                        .chromakey 1
													.scale 100
													.trans v[1066]
													.rgbs 100, 100, 100, 100
													.font Font_UI, v[4511]
													.spacing 0, 0
													.skin "" .stretch
													.mapLayer 9
													.eraseWhenTransfer
													.affectedByFlash
													.affectedByShake
											}
											
									}
									@if s[201] .isOff() {
											@pic[PicID_Popup_1].strpic {
													"CREATE:UNKNOWN"
													.pos v[1301], v[1065] .bottomLeft
													.size 0, 0                        .chromakey 1
													.scale 100
													.trans v[1066]
													.rgbs 100, 100, 100, 100
													.font "", v[4511]
													.spacing 0, 0
													.skin "" .stretch
													.mapLayer 9
													.eraseWhenTransfer
													.affectedByFlash
													.affectedByShake
											}
											
									}
									
							}
							
					} .else bl {
							@comment "###############"
							@comment "Init"
							t[3000..3300] .asg ""
							t[503] .asg ""
							t[505] .asg t[20034]
							@comment "Load"
							v[1942] = current_descriptionID
							v[1941] = v[1215] + v[1942]
							t[2998] .asg t[v[1941]]
							t[2998] .split ",", t[2998], v[1941]
							t[503] .asg t[2999]
							t[2999..3000] .asg ""

							deft {
								UI_TRPDESC_Descslot = 3083
								UI_TRPDESC_Loreslot = 3084
							}
							// setup description
							UI_TRPDESC_Descslot .split "^", t[3201], v[1961]
							UI_TRPDESC_Descslot .asg ""
							@loop v[1961] .dst v[1962] {
									v[1963] = v[1211] + v[1962]
									v[1963] += 200
									UI_TRPDESC_Descslot .cat t[v[1963]] .extract
									UI_TRPDESC_Descslot .cat LF
									
							}
							t[504] .asg UI_TRPDESC_Descslot
							
							// setup lore
							@if UI_TRPDESC_Loreslot.neq "" {
								UI_TRPDESC_Loreslot .split "^", t[3201], v[1961]
								UI_TRPDESC_Loreslot .asg ""
								@loop v[1961] .dst v[1962] {
										v[1963] = v[1211] + v[1962]
										v[1963] += 200
										UI_TRPDESC_Loreslot .cat t[v[1963]] .extract
										UI_TRPDESC_Loreslot .cat LF
										
								}
							}
							t[505] .asg UI_TRPDESC_Loreslot
							
							@comment "###############"
							@comment "Produce:"
							t[501] .asg t[20119]
							t[501] .cat t[503]
							@comment "Costs:"
							t[502] .asg t[20113]
							@if v[31] >= 1 {
									t[502] .cat "\c[5]"
									t[502] .cat t[20114]
									t[502] .cat "\v[31]" .extract
									t[502] .cat " " .extract
									
							}
							@if v[32] >= 1 {
									t[502] .cat "\c[1]"
									t[502] .cat t[20115]
									t[502] .cat "\v[32]" .extract
									t[502] .cat " " .extract
									
							}
							@if v[33] >= 1 {
									t[502] .cat "\c[3]"
									t[502] .cat t[20116]
									t[502] .cat "\v[33]" .extract
									t[502] .cat " " .extract
									
							}
							@if v[34] >= 1 {
									t[502] .cat "\c[8]"
									t[502] .cat t[20117]
									t[502] .cat "\v[34]" .extract
									t[502] .cat " " .extract
									
							}
							t[502] .cat "\c[0]"
							@comment "#LF"
							v[35] = 0
							t[501] .cat LF
							t[501] .cat t[502]
							t[501] .cat LF
							t[501] .cat "..."
							t[501] .cat t[504]
							// If Alt is held down, show Lore as well.
							@if t[505].neq "" {
								t[501] .cat "\c[3]*"
								@if GETKEY_Alt == 1 {
									t[501] .cat "-------"
									t[501] .cat LF
									t[501] .cat t[505]
								}
							}

							@pic[PicID_Popup_1].strpic {
									t[501]
									.pos v[1301], v[1065] .bottomLeft
									.size 0, 0                .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 9
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							@pic[PicID_Popup_1].getInfo .ltrb .currentRect v[350], v[351], v[352], v[353]
							v[11] = 438
							@call .cev 1890
							@pic[PicID_Auxilia_Message_Window].strpic {
									t[3000]
									.pos v[350], v[351] .bottomLeft
									.size 0, 0                .chromakey 1
									.scale 100
									.trans v[1066]
									.rgbs 100, 100, 100, 100
									.font Font_UI, v[4511]
									.spacing 0, 0
									.skin "" .stretch
									.mapLayer 10
									.eraseWhenTransfer
									.affectedByFlash
									.affectedByShake
							}
							
					}
					
			}
			
	}
	s[202].off

}


__fn show_frame_overlap_effect $x $y $w $h {
	@pic[PicID_ButtonSelect].strpic {
		""
		.pos $x, $y .center
		.size $w, $h                    .chromakey 1
		.scale 100
		.trans 20
		.rgbs 0, 200, 0, 100
		.font Font_UI, v[4511]
		.spacing 0, 4
		.skin "Odinscall_mapcam" .nobg .noGradation
		.add
		.mapLayer 9
		.eraseWhenTransfer
	}

}

// bottomleft
__fn show_pupwin1_with_Qstr $QstrId $x $y {
	getQstr($QstrId)
	@pic[PicID_Popup_1].strpic {
		t[3000]
		.pos $x, $y .bottomLeft
		.size 0, 0                        .chromakey 1
		.scale 100
		.trans v[1066]
		.rgbs 100, 100, 100, 100
		.font Font_UI, v[4511]
		.spacing 0, 0
		.skin "" .stretch
		.mapLayer 9
		.eraseWhenTransfer
	}

}


// just check if unit on screen is at clickable position 
// {block} $maskcondbl In this block, set reg10 as a masking condition for agent picking up. only when reg10 == 1, you can use this
// {num} $flag 
// CC_FLAG_ck_static_as_well - If this flag is on, check static agents as well.

def CC_FLAG_ck_static_as_well = 0x1

__fn check_clickable_units $maskcondbl $flag { 

	// init clickable units switches
	def Adrs_clickable_switches_tail = Agents_Limit + __id(bool_agent_is_clickable_head)
	// s[__id(bool_agent_is_clickable_head)..Adrs_clickable_switches_tail].off
	defv agent_pointer = 338 // __id(Temp38)
	defv agent_counter = 339 // __id(Temp39)

	// init clickable agent
	Control_ClickableStaticHolder = -1
	Control_ClickableAgentHolder = -1

	__if $flag & CC_FLAG_ck_static_as_well {
		// ------------------------
		// searching static agents
		// ------------------------

		agent_pointer = v[4533] // get static list 

		@while v[agent_pointer] != 0 {
			Ptr1 = v[agent_pointer] * agent_Basic_Array_size
			val_add(Ptr1,N4701) // Ptr1 += 4701
			v[Ptr1].copy agent_AgentType,12
			@if `agent_AgentBits & AgentBits_FLAG_Drawn_in_screen { // temporarily exclude static
				$maskcondbl // use reg10 as a masking condition for agent picking up.
				@if reg10 == 1 { 
					MACRO_ck_if_current_static_is_clickable_to_reg6 // change here for static agent later
					@if reg6 == 1 { // clickable!
						Control_ClickableStaticHolder = v[agent_pointer]
						@break
					}
				}
			}
			increment_var(agent_pointer)
		}
	}

	// ------------------------
	// searching mobile agents
	// ------------------------

	
	def click_rectangle_size = 8

	// check morton id of where mouse pointer is

	// upper left
	MousePtr_x.copy var3,2
	v[__id(var3)..__id(var4)] -= click_rectangle_size
	get_point_morton_to_reg1([var3,var4])
	TT1 = reg1 // save returned mortid to TT1

	// bottom right
	MousePtr_x.copy var3,2
	v[__id(var3)..__id(var4)] += click_rectangle_size
	get_point_morton_to_reg1([var3,var4])
	TT2 = reg1 // save returned mortid to TT2

	/*@comment "TT1 = upper left morton TT2 = bottom right morton TT5 = shift num"*/
	TT3 = TT1 ^ TT2
	/*@comment "#mask with 11000000" "#mask with 110000" @comment "#mask with 001100" @comment "#mask with 000011"*/
	TT5 = TT3 & 768 ? 10 : TT3 & 192 ? 8 : TT3 & 48 ? 6 : TT3 & 12 ? 4 : TT3 & 3 ? 2 : 0 // isn't this retarded?
	//@comment "#TT6 = morton id"
	TT6 = TT2 >> TT5
	//@comment "#mask end"

	// setting up pointer and counter

	// get ptr
	TT5 >>= 1
	agent_pointer = Adr_MORTON_ListsPtrlink_array_head - TT5
	agent_counter = Adr_MORTON_CountPtrlink_array_head - TT5

	// deref
	agent_pointer.deref agent_pointer,2

	// goto each addresses for the morton id
	agent_pointer += TT6 * Const_save_var_Agents_Limit
	val_add(agent_counter,TT6) // agent_counter += TT6
	agent_counter.deref agent_counter,1 // deref again

	/*
	reg1 >>= 2 // search for dim4
	agent_counter = MORTON_Dim4Count_head + reg1
	agent_counter = v[agent_counter]
	agent_pointer = MORTON_Dim4Lists_head 
	agent_pointer += reg1 * Const_save_var_Agents_Limit
	*/

	@loop agent_counter {
		Ptr1 = v[agent_pointer] * agent_Basic_Array_size
		val_add(Ptr1,N4701) // Ptr1 += 4701
		v[Ptr1].copy agent_AgentType,12
		@if agent_AgentType != 11 { // not STATIC
			@if `agent_AgentBits & AgentBits_FLAG_Drawn_in_screen {
				$maskcondbl // use reg10 as a masking condition for agent picking up.
				@if reg10 == 1 { 
				MACRO_ck_if_current_agent_is_clickable_to_reg6
					@if reg6 == 1 {
						// TT1 = v[agent_pointer] + Adrs_clickable_switches_head_MINUS1
						Control_ClickableAgentHolder = v[agent_pointer]
						// s[TT1].on
						@break
					}
				}
			}
		}

		increment_var(agent_pointer) // agent_pointer += 1
	}

	@if Control_ClickableAgentHolder == -1 { // cannot click movable agents
		@if Control_ClickableStaticHolder != -1 { // but if static clickable
			Control_ClickableAgentHolder.swap Control_ClickableStaticHolder,1 // then swap it
			
		}.else bl{ // otherwise hide agent indicator pic
			@pic[PicID_click_agent_indicator].move{
				.pos v[350], v[351] .bottom
				.scale 100
				.trans 100
				.time 0
				.rgbs 100, 100, 100, 100
			}

		}
	}
	@if Control_ClickableAgentHolder > 0 {
		@pic[PicID_pointer_sub].move { // make terrain square disappear
				.pos v[350], v[351] .bottom
				.scale 100
				.trans 100
				.time 0
				.rgbs 100, 100, 100, 100
			}
	}
}

